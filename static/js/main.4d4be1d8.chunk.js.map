{"version":3,"sources":["ToornamentHelper.ts","ConfigurationStep.tsx","CredentialsStep.tsx","SchedulePhaseComponent.tsx","TournamenStructure.ts","ScheduleStepper.tsx","FetchDialog.tsx","ReviewSchedule.tsx","ApplyDialog.tsx","App.tsx","index.tsx"],"names":["SchedulingMode","ToornamentHelper","apiKey","token","this","readApiKey","readToken","clientId","clientSecret","callback","request","XMLHttpRequest","open","setRequestHeader","addEventListener","event","result","JSON","parse","responseText","updateToken","access_token","expires_in","body","send","sessionStorage","getItem","expireDateString","accessToken","expireDate","removeItem","setItem","newToken","expiresIn","moment","add","toDate","stringify","Date","ressource","paginationIdentifier","viewerCall","customHeaders","maxResults","rangeWidth","tokenIsValid","Error","startsWith","minRange","maxRange","rangeStep","rangeOffset","finalResult","apiCallback","status","remainingItems","push","length","makePagedAPIGETCall","console","error","rangeMin","rangeMax","endpoint","forEach","header","name","value","regex","contentRangeHeader","getResponseHeader","contentRange","match","endIndex","Number","groups","totalItems","Math","max","statusText","NaN","tournamentId","stageId","rangedToornamentGETAPICall","makeAPIGETCall","log","matchId","date","requestBody","scheduled_datetime","format","CredentialsStep","props","handleChangeApiKey","toornamentHelper","updateApiKey","target","setState","credentialsUpdated","handleChangeClientId","handleChangeClientSecret","requestToken","getToken","state","getApiKey","classes","Grid","container","direction","TextField","label","className","textField","onChange","margin","variant","Typography","hidden","Button","color","button","onClick","React","Component","withStyles","theme","createStyles","spacing","marginLeft","marginTop","marginRight","marginBottom","PhaseComponent","handleChangeStartDate","newPhase","phase","startDate","phaseChanged","handleChangePhaseRound","startingRoundId","handleChangePhaseGroup","groupId","handleDelete","item","alignContent","Tooltip","title","disablePast","ampm","FormControl","InputLabel","Select","inputProps","disabled","isFirst","structure","getGroups","map","group","index","MenuItem","id","key","getRounds","filter","round","Fab","size","aria-label","delButton","maxWidth","ConfigurationStep","renderMatchLengthConfig","Table","table","TableHead","TableRow","TableCell","tableHeader","align","TableBody","config","matchLengthSettings","matchLengthSetting","component","scope","numberOfGames","matchLengthMin","handleChangeMatchLength","type","isValidMatchLength","newCfg","scheduleConfigChanged","handleChangeMatchMode","schedulingMode","isInteger","onPhaseChanged","phases","splice","addPhase","newRound","find","findIndex","undefined","modes","Direct","Daily","Weekly","Monthly","SchedulePhaseComponent","paragraph","mode","utils","MomentUtils","canAddNewPhase","minWidth","fontSize","fontWeight","palette","text","primary","borderBottomColor","secondary","main","borderBottomStyle","borderBottomWidth","flexShrink","TournamentStructure","rounds","matches","bracketType","roundDependencies","createDependencies","dependencyIndex","dep","roundId","precedingRoundIds","followingRoundIds","dependency","opponents","opp","sourceNodeId","s","nodeId","source","dId","depIndex","d","fId","BracketType","Bracket","roundDep","Rounds","firstRound","rDep","rId","roundIndex","getLastRounds","scheduleRound","r","p","previousRounds","getPrecedingRounds","scheduledAt","previousDates","sort","a","b","getTime","prevStart","lengthSetting","l","roundLength","FetchDialog","fetchOnUpdate","roundsFinished","matchesFinished","groupsFinished","matchIndex","bracketNodeIndex","getOrganizerGroups","results","number","getOrganizerRounds","group_id","settings","getOrganizerMatches","matchResults","round_id","getNodes","getBracketNodes","m","opponent","sourceType","source_type","source_node_id","callNext","getOrganizerMatchGames","newProps","fetchStageData","Dialog","DialogTitle","DialogContent","iconContainer","checkIcon","CircularProgress","green","width","ReviewSchedule","getGroupName","tableRows","ApplyDialog","progress","total","tournamentIdItemName","stageIdItemName","ScheduleStepper","steps","handleNext","activeStep","fetching","getOrganizerStages","stages","stage","newScheduleConfig","scheduleConfig","fetchDialogOpen","scheduleTournament","applySchedule","applyOpen","getMatches","applyTotal","applyProgress","currentIndex","scheduleNext","continueApplying","scheduleMatch","requestStatus","fetchCallback","gameLengths","n","firstRounds","getFirstRounds","handleBack","handleReset","handleChangeTournamentId","handleChangeStageId","canProceed","credentialsReady","getStepContent","step","display","List","ListItem","selected","ListItemText","hasApiKey","root","Stepper","Step","StepLabel","instructions","thickness","src","toorImg","App","fetchEverything","CssBaseline","AppBar","position","appBar","Toolbar","noWrap","content","justifyContent","menuButton","hide","flexGrow","padding","paper","overflowX","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4d4be1d8.chunk.js","sourcesContent":["import moment from 'moment';\r\n\r\nconst accessTokenItemName = 'tss_t_at';\r\nconst expireDateItemName = 'tss_t_ed';\r\nconst apiKeyItemName = 'tss_t_ak';\r\n\r\nexport interface ToornamentToken {\r\n    accessToken: string;\r\n    expireDate: Date;\r\n}\r\n\r\nexport default class ToornamentHelper {\r\n    private apiKey: string | null;\r\n    private token: ToornamentToken | null;\r\n\r\n    constructor() {\r\n        this.apiKey = this.readApiKey();\r\n        this.token = this.readToken();\r\n    }\r\n\r\n    public getToken(clientId: string, clientSecret: string, callback: () => void) {\r\n        if (this.apiKey == null) {\r\n            return false;\r\n        }\r\n\r\n        let request = new XMLHttpRequest();\r\n        request.open('POST', 'https://api.toornament.com/oauth/v2/token');\r\n        request.setRequestHeader('X-Api-Key', this.apiKey);\r\n        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n        request.addEventListener('load', (event) => {\r\n            const result = JSON.parse(request.responseText);\r\n            this.updateToken(result.access_token, result.expires_in);\r\n            callback();\r\n        });\r\n        const body = `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}&scope=organizer:result`\r\n        request.send(body);\r\n    }\r\n\r\n    private readToken(): ToornamentToken | null {\r\n        const token = sessionStorage.getItem(accessTokenItemName);\r\n        if (token == null) {\r\n            return null;\r\n        }\r\n\r\n        const expireDateString = sessionStorage.getItem(expireDateItemName);\r\n        if (expireDateString == null) {\r\n            return null;\r\n        }\r\n\r\n        const expireDate: Date = JSON.parse(expireDateString);\r\n        return { accessToken: token, expireDate: expireDate };\r\n    }\r\n\r\n    private readApiKey(): string | null {\r\n        return sessionStorage.getItem(apiKeyItemName);\r\n    }\r\n\r\n    public updateApiKey(apiKey: string) {\r\n        if (apiKey == '') {\r\n            this.apiKey = null;\r\n            sessionStorage.removeItem(apiKeyItemName);\r\n            return;\r\n        }\r\n\r\n        this.apiKey = apiKey;\r\n        sessionStorage.setItem(apiKeyItemName, apiKey);\r\n    }\r\n\r\n    public hasApiKey() {\r\n        return this.apiKey != null && this.apiKey != '';\r\n    }\r\n\r\n    public getApiKey(): string | null {\r\n        return this.apiKey;\r\n    }\r\n\r\n    private updateToken(newToken: string, expiresIn: number) {\r\n        const expireMoment = moment().add(expiresIn, 'minutes');\r\n        const expireDate = expireMoment.toDate();\r\n        sessionStorage.setItem(accessTokenItemName, newToken);\r\n        sessionStorage.setItem(expireDateItemName, JSON.stringify(expireDate));\r\n        this.token = { accessToken: newToken, expireDate: expireDate }\r\n    }\r\n\r\n    public tokenIsValid(): boolean {\r\n        if (this.token == null) {\r\n            return false;\r\n        }\r\n\r\n        if (this.token.expireDate < new Date()) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public rangedToornamentGETAPICall(ressource: string, paginationIdentifier: string, callback: (result: any[]) => void, viewerCall: boolean = false,\r\n        customHeaders: { name: string, value: string }[] = [], maxResults: number = -1, rangeWidth: number = 50): boolean {\r\n        if (this.apiKey == null) {\r\n            return false;\r\n        }\r\n\r\n        if (!viewerCall && !this.tokenIsValid()) {\r\n            throw new Error('Access Token invalid. Create new Token.');\r\n        }\r\n\r\n        if (!ressource.startsWith('/')) {\r\n            ressource = '/' + ressource;\r\n        }\r\n\r\n        const minRange = 0;\r\n        const maxRange = rangeWidth - 1;\r\n        const rangeStep = rangeWidth;\r\n        let rangeOffset = 0;\r\n\r\n        const finalResult: any[] = [];\r\n        const apiCallback = (result: any, status: number, remainingItems: number) => {\r\n            if (status >= 200 && status < 300) {\r\n                finalResult.push(...result);\r\n\r\n                if (remainingItems <= 0 || (result.length >= maxResults && maxResults > 0)) {\r\n                    callback(finalResult);\r\n                } else {\r\n                    rangeOffset += rangeStep;\r\n                    this.makePagedAPIGETCall(ressource, paginationIdentifier, minRange + rangeOffset, maxRange + rangeOffset, apiCallback, viewerCall, customHeaders);\r\n                }\r\n            } else {\r\n                console.error(result);\r\n            }\r\n        };\r\n        this.makePagedAPIGETCall(ressource, paginationIdentifier, minRange, maxRange, apiCallback, viewerCall, customHeaders);\r\n\r\n        return true;\r\n    }\r\n\r\n    private makePagedAPIGETCall(ressource: string, paginationIdentifier: string, rangeMin: number, rangeMax: number,\r\n        callback: (result: any, status: number, remainingItems: number) => void, viewerCall: boolean = true, customHeaders: { name: string, value: string }[] = []) {\r\n        if (this.apiKey == null) {\r\n            return false;\r\n        }\r\n\r\n        let request = new XMLHttpRequest();\r\n        const endpoint = `https://api.toornament.com/${viewerCall ? 'viewer' : 'organizer'}/v2${ressource}`;\r\n        request.open('GET', endpoint);\r\n        request.setRequestHeader('X-Api-Key', this.apiKey);\r\n\r\n        if (!viewerCall) {\r\n            if (!this.tokenIsValid()) {\r\n                throw new Error('Access Token invalid. Create new Token.');\r\n            }\r\n\r\n            request.setRequestHeader('Authorization', `Bearer ${this.token!.accessToken}`);\r\n        }\r\n\r\n        request.setRequestHeader('Range', `${paginationIdentifier}=${rangeMin}-${rangeMax}`);\r\n        customHeaders.forEach(header => request.setRequestHeader(header.name, header.value));\r\n        request.addEventListener('load', (event) => {\r\n            if (request.status >= 200 && request.status < 300) {\r\n                let remainingItems = 0;\r\n                const result = JSON.parse(request.responseText);\r\n                const regex = /.*\\s*(?<start>\\d+)-(?<end>\\d+)\\/(?<total>\\d+)/;\r\n                const contentRangeHeader = request.getResponseHeader('Content-Range');\r\n                if (contentRangeHeader != null) {\r\n                    const contentRange = contentRangeHeader.match(regex);\r\n                    if (contentRange != null && contentRange.length >= 4) {\r\n                        const endIndex = Number(contentRange.groups!['end']);\r\n                        const totalItems = Number(contentRange.groups!['total']);\r\n                        remainingItems = Math.max(remainingItems, totalItems - endIndex - 1);\r\n                    }\r\n                } else {\r\n                    remainingItems = result.length >= 50 ? 50 : 0;\r\n                }\r\n\r\n                callback(result, request.status, remainingItems);\r\n            } else {\r\n                callback(request.statusText, request.status, NaN);\r\n            }\r\n        });\r\n        request.send();\r\n    }\r\n\r\n    private makeAPIGETCall(ressource: string, callback: (result: any, status: number) => void, viewerCall: boolean = true,\r\n        customHeaders: { name: string, value: string }[] = []) {\r\n        if (this.apiKey == null) {\r\n            return false;\r\n        }\r\n\r\n        let request = new XMLHttpRequest();\r\n        const endpoint = `https://api.toornament.com/${viewerCall ? 'viewer' : 'organizer'}/v2${ressource}`;\r\n        request.open('GET', endpoint);\r\n        request.setRequestHeader('X-Api-Key', this.apiKey);\r\n\r\n        if (!viewerCall) {\r\n            if (!this.tokenIsValid()) {\r\n                throw new Error('Access Token invalid. Create new Token.');\r\n            }\r\n\r\n            request.setRequestHeader('Authorization', `Bearer ${this.token!.accessToken}`);\r\n        }\r\n\r\n        customHeaders.forEach(header => request.setRequestHeader(header.name, header.value));\r\n        request.addEventListener('load', (event) => {\r\n            if (request.status >= 200 && request.status < 300) {\r\n                const result = JSON.parse(request.responseText);\r\n                callback(result, request.status);\r\n            } else {\r\n                callback(request.statusText, request.status);\r\n            }\r\n        });\r\n        request.send();\r\n    }\r\n\r\n    public getOrganizerMatches(tournamentId: string, stageId: string, callback: (results: any[]) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/matches?stage_ids=${stageId}`\r\n        this.rangedToornamentGETAPICall(ressource, 'matches', callback);\r\n    }\r\n\r\n    public getOrganizerRounds(tournamentId: string, stageId: string, callback: (result: any) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/rounds?stage_ids=${stageId}`\r\n        this.rangedToornamentGETAPICall(ressource, 'rounds', callback, false);\r\n    }\r\n\r\n    public getOrganizerStages(tournamentId: string, callback: (result: any) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/stages`\r\n        this.makeAPIGETCall(ressource, callback, false);\r\n    }\r\n\r\n    public getOrganizerTournament(tournamentId: string) {\r\n        let ressource = `/tournaments/${tournamentId}`\r\n        this.makeAPIGETCall(ressource, (result) => {\r\n            console.log(result);\r\n        }, false);\r\n    }\r\n\r\n    public getOrganizerMatchGames(tournamentId: string, matchId: string, callback: (result: any) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/matches/${matchId}/games`\r\n        this.rangedToornamentGETAPICall(ressource, 'games', callback, false);\r\n    }\r\n\r\n    public getBracketNodes(tournamentId: string, stageId: string, callback: (result: any) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/stages/${stageId}/bracket-nodes`\r\n        this.rangedToornamentGETAPICall(ressource, 'nodes', callback, true);\r\n    }\r\n\r\n    public getOrganizerGroups(tournamentId: string, stageId: string, callback: (result: any) => void) {\r\n        let ressource = `/tournaments/${tournamentId}/groups?stage_ids=${stageId}`\r\n        this.rangedToornamentGETAPICall(ressource, 'groups', callback, false);\r\n    }\r\n\r\n    public scheduleMatch(tournamentId: string, matchId: string, date: Date, callback: (result: any, requestStatus: number) => void) {\r\n        if (this.apiKey == null) {\r\n            return false;\r\n        }\r\n\r\n        const ressource = `https://api.toornament.com/organizer/v2/tournaments/${tournamentId}/matches/${matchId}`;\r\n        const requestBody = { scheduled_datetime: moment(date).format('YYYY-MM-DDTHH:mm:ssZ') } // 2015-12-31T00:00:00+00:00\r\n        let request = new XMLHttpRequest();\r\n        request.open('PATCH', ressource);\r\n        request.setRequestHeader('X-Api-Key', this.apiKey);\r\n\r\n        if (!this.tokenIsValid()) {\r\n            throw new Error('Access Token invalid. Create new Token.');\r\n        }\r\n\r\n        request.setRequestHeader('Authorization', `Bearer ${this.token!.accessToken}`);\r\n        request.addEventListener('load', () => {\r\n            if (request.status >= 200 && request.status < 300) {\r\n                const result = JSON.parse(request.responseText);\r\n                callback(result, request.status);\r\n            } else {\r\n                callback(request.statusText, request.status);\r\n            }\r\n        });\r\n\r\n        request.send(JSON.stringify(requestBody));\r\n    }\r\n}","import React from 'react';\r\nimport {\r\n    Typography, Button, withStyles, createStyles, Theme, TextField, Grid, Select, MenuItem,\r\n    Table, TableHead, TableRow, TableCell, TableBody, FormControl, InputLabel, Tooltip\r\n} from '@material-ui/core';\r\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\r\nimport MomentUtils from '@date-io/moment';\r\nimport TournamentStructure from './TournamenStructure';\r\nimport SchedulePhaseComponent from './SchedulePhaseComponent';\r\nimport { BracketType } from './ScheduleStepper';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    textField: {\r\n        marginTop: theme.spacing(1),\r\n        marginRight: theme.spacing(2),\r\n        marginBottom: theme.spacing(1),\r\n        maxWidth: 300,\r\n    },\r\n    button: {\r\n        marginLeft: theme.spacing(2),\r\n        marginTop: theme.spacing(1),\r\n        marginRight: theme.spacing(2),\r\n        marginBottom: theme.spacing(1),\r\n    },\r\n    table: {\r\n        minWidth: 450,\r\n        maxWidth: 600,\r\n    },\r\n    tableHeader: {\r\n        fontSize: '1em',\r\n        fontWeight: 'bolder',\r\n        color: theme.palette.text.primary,\r\n    },\r\n    title: {\r\n        marginTop: theme.spacing(3),\r\n        marginBottom: theme.spacing(1),\r\n        borderBottomColor: theme.palette.secondary.main,\r\n        borderBottomStyle: 'solid',\r\n        borderBottomWidth: 4,\r\n        flexShrink: 1,\r\n    }\r\n});\r\n\r\nexport interface MatchLengthSettings {\r\n    numberOfGames: number;\r\n    matchLengthMin: number;\r\n}\r\n\r\nexport enum SchedulingMode {\r\n    Monthly = 'Monthly',\r\n    Weekly = 'Weekly',\r\n    Daily = 'Daily',\r\n    Direct = 'Direct',\r\n}\r\n\r\nexport interface SchedulePhase {\r\n    groupId: string;\r\n    startingRoundId: string;\r\n    startDate: Date;\r\n    isFirst: boolean;\r\n}\r\n\r\nexport interface ScheduleConfig {\r\n    schedulingMode: SchedulingMode;\r\n    bracketType: BracketType;\r\n    matchLengthSettings: MatchLengthSettings[];\r\n    phases: SchedulePhase[];\r\n}\r\n\r\ninterface ConfigurationStepProps {\r\n    structure: TournamentStructure;\r\n    config: ScheduleConfig;\r\n    scheduleConfigChanged: (config: ScheduleConfig) => void;\r\n    classes?: any;\r\n}\r\n\r\nclass ConfigurationStep extends React.Component<ConfigurationStepProps, {}> {\r\n    constructor(props: ConfigurationStepProps) {\r\n        super(props);\r\n    }\r\n\r\n    renderMatchLengthConfig = () => {\r\n        const { classes } = this.props;\r\n        return (\r\n            <Table className={classes.table} size='small'>\r\n                <TableHead>\r\n                    <TableRow >\r\n                        <TableCell className={classes.tableHeader} align='right'>Games per Match</TableCell>\r\n                        <TableCell className={classes.tableHeader} >Time per Match (Minutes)</TableCell>\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {this.props.config.matchLengthSettings.map((matchLengthSetting, index) => (\r\n                        <TableRow key={`row-${index}`}>\r\n                            <TableCell component='th' scope='row' align='right'>\r\n                                {matchLengthSetting.numberOfGames}\r\n                            </TableCell>\r\n                            <TableCell >\r\n                                <TextField\r\n                                    label='Match Length'\r\n                                    className={classes.textField}\r\n                                    value={matchLengthSetting.matchLengthMin}\r\n                                    onChange={this.handleChangeMatchLength(index)}\r\n                                    margin='dense'\r\n                                    variant='outlined'\r\n                                    type='number'\r\n                                    error={!this.isValidMatchLength(matchLengthSetting.matchLengthMin)}\r\n                                />\r\n                            </TableCell>\r\n                        </TableRow>\r\n                    ))}\r\n                </TableBody>\r\n            </Table>\r\n        );\r\n    }\r\n\r\n    handleChangeMatchLength = (index: number) => (event: any) => {\r\n        const newCfg = this.props.config;\r\n        newCfg.matchLengthSettings[index].matchLengthMin = Number(event.target.value);\r\n        this.props.scheduleConfigChanged(newCfg);\r\n    }\r\n\r\n    handleChangeMatchMode = (event: any) => {\r\n        const newCfg = this.props.config;\r\n        newCfg.schedulingMode = event.target.value;\r\n        this.props.scheduleConfigChanged(newCfg);\r\n    }\r\n\r\n    isValidMatchLength = (length: number): boolean => {\r\n        return length > 0 && Number.isInteger(length);\r\n    }\r\n\r\n    onPhaseChanged = (index: number) => (phase: SchedulePhase | null) => {\r\n        const newCfg = this.props.config;\r\n        if (phase != null) {\r\n            newCfg.phases[index] = phase;\r\n        } else {\r\n            newCfg.phases.splice(index, 1);\r\n        }\r\n        this.props.scheduleConfigChanged(newCfg);\r\n    }\r\n\r\n    canAddNewPhase(): boolean {\r\n        return this.props.config.phases.length < this.props.structure.getRounds().length;\r\n    }\r\n\r\n    addPhase = () => {\r\n        const newCfg = this.props.config;\r\n        const newRound = this.props.structure.getRounds().find(round => this.props.config.phases.findIndex(phase => phase.startingRoundId == round.id) < 0);\r\n        if (newRound == undefined) {\r\n            return; //add user feedback\r\n        }\r\n\r\n        newCfg.phases.push({\r\n            groupId: newRound.groupId,\r\n            startingRoundId: newRound.id,\r\n            startDate: newCfg.phases[newCfg.phases.length - 1].startDate,\r\n            isFirst: false,\r\n        });\r\n\r\n        this.props.scheduleConfigChanged(newCfg);\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n        const modes: SchedulingMode[] = [SchedulingMode.Direct, SchedulingMode.Daily, SchedulingMode.Weekly, SchedulingMode.Monthly]\r\n\r\n        const phases = this.props.config.phases.map((phase, index) => {\r\n            return (\r\n                <SchedulePhaseComponent\r\n                    phase={phase}\r\n                    structure={this.props.structure}\r\n                    phaseChanged={this.onPhaseChanged(index)}\r\n                    key={`phase-${index}`}\r\n                />\r\n            );\r\n        });\r\n\r\n        return (\r\n            <Grid\r\n                container\r\n                direction='column'\r\n            >\r\n                <Typography className={classes.title} variant='h6'>Schedule Mode</Typography>\r\n                <Typography paragraph>Decide how rounds should be scheduled. By specifying a mode other than {SchedulingMode.Direct} you\r\n                can schedule your matches on a daily, weekly or monthly basis. Each round is going to take place\r\n                at a new date. In {SchedulingMode.Direct} mode matches will occur at the earliest time after all previous matches have been played.\r\n                Therefore it is well suited for brackets.</Typography>\r\n                <FormControl className={classes.textField}>\r\n                    <InputLabel>Schedule Mode</InputLabel>\r\n                    <Select\r\n                        value={this.props.config.schedulingMode}\r\n                        onChange={this.handleChangeMatchMode}\r\n                        inputProps={{\r\n                            name: 'schedulingMode',\r\n                        }}\r\n                    >\r\n                        {modes.map((mode, index) => {\r\n                            return (<MenuItem value={mode} key={`mode-${index}-mi`}>{mode}</MenuItem>)\r\n                        })}\r\n                    </Select>\r\n                </FormControl>\r\n                <Typography className={classes.title} variant='h6' component='div'>Manage Phases</Typography>\r\n                <Typography>\r\n                    You can use Phases to start a part of your tournament at a different time. For example\r\n                    if you wanted to skip a day in your weekly round robin because its christmas eve or something, you would\r\n                    add a new phase starting at the first match day after the skipped day.\r\n                </Typography>\r\n                <Typography>\r\n                    This also enables you to use the {SchedulingMode.Direct} mode to schedule a bracket over the course of two days\r\n                    by adding a phase for the second day.\r\n                </Typography>\r\n                <Typography>\r\n                    Please note that the integrety of your structure will not be verified. You are resposible for starting phases at the right time and date.\r\n                    If you do not need to use phases just use the first one as the starting date for your tournament.\r\n                </Typography>\r\n                <MuiPickersUtilsProvider utils={MomentUtils}>\r\n                    {phases}\r\n                    <Button\r\n                        variant='contained'\r\n                        color='primary'\r\n                        onClick={this.addPhase}\r\n                        disabled={!this.canAddNewPhase()}\r\n                    >\r\n                        Add Phase\r\n                    </Button>\r\n                </MuiPickersUtilsProvider>\r\n                <Typography className={classes.title} variant='h6'>Match Length</Typography>\r\n                {this.renderMatchLengthConfig()}\r\n            </Grid>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(ConfigurationStep);","import React from 'react';\r\nimport { Typography, Button, withStyles, createStyles, Theme, TextField, Grid } from '@material-ui/core';\r\nimport ToornamentHelper from './ToornamentHelper';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    textField: {\r\n        margin: theme.spacing(1),\r\n    },\r\n    button: {\r\n        marginLeft: theme.spacing(2),\r\n        marginTop: theme.spacing(1),\r\n        marginRight: theme.spacing(2),\r\n        marginBottom: theme.spacing(1),\r\n    }\r\n})\r\n\r\ninterface CredentialsStepState {\r\n    apiKey: string,\r\n    clientId: string,\r\n    clientSecret: string,\r\n}\r\n\r\ninterface CredentialsStepProps {\r\n    toornamentHelper: ToornamentHelper;\r\n    credentialsUpdated: () => void;\r\n    classes?: any;\r\n}\r\n\r\nclass CredentialsStep extends React.Component<CredentialsStepProps, CredentialsStepState> {\r\n    constructor(props: CredentialsStepProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            apiKey: props.toornamentHelper.getApiKey() || '',\r\n            clientId: '',\r\n            clientSecret: '',\r\n        }\r\n    }\r\n\r\n    handleChangeApiKey = (event: any) => {\r\n        this.props.toornamentHelper.updateApiKey(event.target.value);\r\n        this.setState({ apiKey: event.target.value });\r\n        this.props.credentialsUpdated();\r\n    }\r\n\r\n    handleChangeClientId = (event: any) => {\r\n        this.setState({ clientId: event.target.value });\r\n    }\r\n\r\n    handleChangeClientSecret = (event: any) => {\r\n        this.setState({ clientSecret: event.target.value });\r\n    }\r\n\r\n    requestToken = () => {\r\n        if (!this.props.toornamentHelper.tokenIsValid()) {\r\n            const callback = () => {\r\n                this.props.credentialsUpdated();\r\n            }\r\n            this.props.toornamentHelper.getToken(this.state.clientId, this.state.clientSecret, callback);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n\r\n        return (\r\n            <Grid\r\n                container\r\n                direction='column'\r\n            >\r\n                <TextField\r\n                    label='Api Key'\r\n                    className={classes.textField}\r\n                    value={this.state.apiKey}\r\n                    onChange={this.handleChangeApiKey}\r\n                    margin='dense'\r\n                    variant='outlined'\r\n                />\r\n                <Typography\r\n                    hidden={this.props.toornamentHelper.getApiKey() != null}\r\n                >Enter your Api Key!</Typography>\r\n                <TextField\r\n                    label='Client Id'\r\n                    className={classes.textField}\r\n                    value={this.state.clientId}\r\n                    onChange={this.handleChangeClientId}\r\n                    margin='dense'\r\n                    variant='outlined'\r\n                />\r\n                <TextField\r\n                    label='Client Secret'\r\n                    className={classes.textField}\r\n                    value={this.state.clientSecret}\r\n                    onChange={this.handleChangeClientSecret}\r\n                    margin='dense'\r\n                    variant='outlined'\r\n                />\r\n                <Button\r\n                    variant='contained'\r\n                    color='primary'\r\n                    className={classes.button}\r\n                    onClick={this.requestToken}\r\n                >\r\n                    Request Token\r\n                </Button>\r\n                <Typography\r\n                    hidden={this.props.toornamentHelper.tokenIsValid()}\r\n                >Request a valid token!</Typography>\r\n                <Typography\r\n                    hidden={!this.props.toornamentHelper.tokenIsValid()}\r\n                >You have a valid token, you do not need to request one!</Typography>\r\n            </Grid>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(CredentialsStep);","import React from 'react';\r\nimport { SchedulePhase } from './ConfigurationStep';\r\nimport { Grid, Tooltip, FormControl, Select, InputLabel, Theme, createStyles, withStyles, MenuItem, Fab } from '@material-ui/core';\r\nimport { KeyboardDateTimePicker } from '@material-ui/pickers';\r\nimport TournamentStructure from './TournamenStructure';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    textField: {\r\n        margin: theme.spacing(1),\r\n        maxWidth: 220,\r\n    },\r\n    delButton:{\r\n        margin: theme.spacing(1),\r\n    }\r\n});\r\n\r\ninterface PhaseComponentProps {\r\n    phase: SchedulePhase;\r\n    structure: TournamentStructure;\r\n    phaseChanged: (phase: SchedulePhase | null) => void;\r\n    classes?: any;\r\n}\r\n\r\nclass PhaseComponent extends React.Component<PhaseComponentProps, any> {\r\n    handleChangeStartDate = (moment: any) => {\r\n        const newPhase = this.props.phase;\r\n        newPhase.startDate = moment == null ? moment : moment.toDate();\r\n        this.props.phaseChanged(newPhase);\r\n    }\r\n\r\n    handleChangePhaseRound = (event: any) => {\r\n        const newPhase = this.props.phase;\r\n        newPhase.startingRoundId = event.target.value;\r\n        this.props.phaseChanged(newPhase);;\r\n    }\r\n\r\n    handleChangePhaseGroup = (event: any) => {\r\n        const newPhase = this.props.phase;\r\n        newPhase.groupId = event.target.value;\r\n        this.props.phaseChanged(newPhase);\r\n    }\r\n\r\n    handleDelete = () => {\r\n        this.props.phaseChanged(null);\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n        return (\r\n            <Grid\r\n                item\r\n                container\r\n                direction='row'\r\n                alignContent='center'\r\n            >\r\n                <Tooltip title='Select start date'>\r\n                    <div>\r\n                        <KeyboardDateTimePicker\r\n                            disablePast\r\n                            className={classes.textField}\r\n                            ampm={false}\r\n                            value={this.props.phase.startDate}\r\n                            label='Phase Start'\r\n                            onChange={this.handleChangeStartDate}\r\n                        />\r\n                    </div>\r\n                </Tooltip>\r\n                <FormControl className={classes.textField}>\r\n                    <InputLabel>Group</InputLabel>\r\n                    <Select\r\n                        value={this.props.phase.groupId}\r\n                        onChange={this.handleChangePhaseGroup}\r\n                        inputProps={{\r\n                            name: 'startRound',\r\n                        }}\r\n                        disabled={this.props.phase.isFirst}\r\n                    >\r\n                        {this.props.structure.getGroups().map((group, index) => {\r\n                            return (<MenuItem value={group.id} key={`group-${index}-mi`}>{group.name}</MenuItem>)\r\n                        })}\r\n                    </Select>\r\n                </FormControl>\r\n                <FormControl className={classes.textField}>\r\n                    <InputLabel>Start Round</InputLabel>\r\n                    <Select\r\n                        value={this.props.phase.startingRoundId}\r\n                        onChange={this.handleChangePhaseRound}\r\n                        inputProps={{\r\n                            name: 'startRound',\r\n                        }}\r\n                        disabled={this.props.phase.isFirst}\r\n                    >\r\n                        {this.props.structure.getRounds().filter(round => round.groupId == this.props.phase.groupId).map((round, index) => {\r\n                            return (<MenuItem value={round.id} key={`round-${index}-mi`}>{round.name}</MenuItem>)\r\n                        })}\r\n                    </Select>\r\n                </FormControl>\r\n                {!this.props.phase.isFirst &&\r\n                        <Fab\r\n                            size='small'\r\n                            aria-label='Delete'\r\n                            className={classes.delButton}\r\n                            onClick={this.handleDelete}\r\n                        >\r\n                            <DeleteIcon />\r\n                        </Fab>\r\n                }\r\n            </Grid>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(PhaseComponent);","import { ScheduleRound, ScheduleGroup, ScheduleMatch, BracketType } from \"./ScheduleStepper\";\r\nimport { MatchLengthSettings, SchedulePhase, SchedulingMode, ScheduleConfig } from \"./ConfigurationStep\";\r\nimport moment from 'moment';\r\n\r\n\r\ninterface RoundDependency {\r\n    roundId: string;\r\n    precedingRoundIds: string[];\r\n    followingRoundIds: string[];\r\n}\r\n\r\nexport default class TournamentStructure {\r\n    private rounds: ScheduleRound[];\r\n    private groups: ScheduleGroup[];\r\n    private matches: ScheduleMatch[];\r\n    private bracketType: BracketType;\r\n\r\n    private roundDependencies: RoundDependency[];\r\n\r\n    constructor(rounds: ScheduleRound[], groups: ScheduleGroup[], matches: ScheduleMatch[], bracketType: BracketType) {\r\n        this.rounds = rounds;\r\n        this.groups = groups;\r\n        this.matches = matches;\r\n        this.bracketType = bracketType;\r\n        this.roundDependencies = [];\r\n        this.createDependencies();\r\n    }\r\n\r\n    private createDependencies() {\r\n        this.matches.forEach((match, index) => {\r\n            let dependencyIndex = this.roundDependencies.findIndex(dep => dep.roundId == match.roundId);\r\n            if (dependencyIndex < 0) {\r\n                dependencyIndex = this.roundDependencies.length;\r\n                this.roundDependencies.push({\r\n                    roundId: match.roundId,\r\n                    precedingRoundIds: [],\r\n                    followingRoundIds: [],\r\n                });\r\n            }\r\n\r\n            const dependency = this.roundDependencies[dependencyIndex];\r\n            const precedingRoundIds: string[] = [];\r\n            const sourceNodeIds = match.opponents.map(opp => opp.sourceNodeId).filter(s => s != null);\r\n\r\n            sourceNodeIds.forEach(nodeId => {\r\n                const source = this.matches.find(match => match.id == nodeId);\r\n                if (source != undefined && dependency.precedingRoundIds.findIndex(id => id == source.roundId) < 0\r\n                    && precedingRoundIds.findIndex(id => id == source.roundId) < 0) {\r\n                    precedingRoundIds.push(source.roundId);\r\n                }\r\n            });\r\n\r\n            let followingRoundIds = this.roundDependencies.filter(dep => dep.precedingRoundIds.findIndex(id => id == match.roundId) >= 0)\r\n                .map(dep => dep.roundId);\r\n            followingRoundIds = followingRoundIds.filter(id => dependency.followingRoundIds.findIndex(dId => id == dId) < 0);\r\n\r\n            this.roundDependencies[dependencyIndex].precedingRoundIds.push(...precedingRoundIds);\r\n            this.roundDependencies[dependencyIndex].followingRoundIds.push(...followingRoundIds);\r\n\r\n            precedingRoundIds.forEach(id => {\r\n                const depIndex = this.roundDependencies.findIndex(d => d.roundId == id);\r\n                if (depIndex >= 0 && this.roundDependencies[depIndex].followingRoundIds.findIndex(fId => fId == match.roundId) < 0) {\r\n                    this.roundDependencies[depIndex].followingRoundIds.push(match.roundId);\r\n                }\r\n            });\r\n\r\n            this.roundDependencies[dependencyIndex] = dependency\r\n        });\r\n    }\r\n\r\n    public getRounds(): ScheduleRound[] {\r\n        return this.rounds;\r\n    }\r\n\r\n    public getMatches(): ScheduleMatch[] {\r\n        return this.matches;\r\n    }\r\n\r\n    public getGroups(): ScheduleGroup[] {\r\n        return this.groups;\r\n    }\r\n\r\n    public getFirstRounds(): ScheduleRound[] {\r\n        const rounds: ScheduleRound[] = [];\r\n        switch (this.bracketType) {\r\n            case BracketType.Bracket:\r\n                let roundDeps = this.roundDependencies.filter(roundDep => roundDep.precedingRoundIds.length == 0);\r\n                roundDeps.forEach(roundDep => {\r\n                    const round = this.rounds.find(round => round.id == roundDep.roundId);\r\n                    if (round != undefined) {\r\n                        rounds.push(round);\r\n                    }\r\n                });\r\n                break;\r\n            default:\r\n            case BracketType.Rounds:\r\n                this.groups.forEach(group => {\r\n                    const firstRound = this.rounds.find(round => round.groupId == group.id);\r\n                    if (firstRound != undefined) {\r\n                        rounds.push(firstRound);\r\n                    }\r\n                })\r\n                break;\r\n        }\r\n        return rounds;\r\n    }\r\n\r\n    public getFollowingRounds(roundId: string): ScheduleRound[] {\r\n        const roundDep = this.roundDependencies.find(rDep => rDep.roundId == roundId);\r\n        if (roundDep == undefined) {\r\n            return [];\r\n        }\r\n\r\n        const result = this.rounds.filter(round => roundDep.followingRoundIds.findIndex(rId => rId == round.id) >= 0);\r\n        return result;\r\n    }\r\n\r\n    public getPrecedingRounds(roundId: string): ScheduleRound[] {\r\n        let result: ScheduleRound[] = [];\r\n        switch (this.bracketType) {\r\n            case BracketType.Bracket:\r\n                const roundDep = this.roundDependencies.find(rDep => rDep.roundId == roundId);\r\n                if (roundDep == undefined) {\r\n                    break;\r\n                }\r\n\r\n                result = this.rounds.filter(round => roundDep.precedingRoundIds.findIndex(rId => rId == round.id) >= 0);\r\n                break;\r\n            case BracketType.Rounds:\r\n            default:\r\n                const roundsByGroup = this.groups.map(group => {\r\n                    return this.rounds.filter(round => round.groupId == group.id);\r\n                });\r\n                roundsByGroup.forEach(rounds => {\r\n                    const roundIndex = rounds.findIndex(round => round.id == roundId);\r\n                    if (roundIndex > 0) {\r\n                        result.push(rounds[roundIndex - 1]);\r\n                    }\r\n                })\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public getLastRounds() {\r\n        return this.rounds.filter(round => this.roundDependencies.findIndex(rDep => rDep.roundId == round.id && rDep.followingRoundIds.length == 0) >= 0);\r\n    }\r\n\r\n    public scheduleTournament(config: ScheduleConfig) {\r\n        const lastRounds = this.getLastRounds();\r\n        lastRounds.forEach(round => this.scheduleRound(round.id, config))\r\n    }\r\n\r\n    private scheduleRound(roundId: string, config: ScheduleConfig): Date {\r\n        const { matchLengthSettings, phases, schedulingMode } = config;\r\n        const roundIndex = this.rounds.findIndex(r => r.id == roundId);\r\n        if (roundIndex < 0) {\r\n            throw new Error('Round must be in TournamentStructure.');\r\n        }\r\n\r\n        const round = this.rounds[roundIndex];\r\n        // check if round is first round of a phase\r\n        const phase = phases.find(p => p.startingRoundId == round.id);\r\n        const previousRounds: ScheduleRound[] = this.getPrecedingRounds(round.id);\r\n        if (phase != undefined) {\r\n            // return phase start date as start date\r\n            this.rounds[roundIndex].scheduledAt = phase.startDate;\r\n            previousRounds.forEach(r => this.scheduleRound(r.id, config));\r\n        } else {\r\n            // schedule round based on max of previous rounds\r\n            if (previousRounds.length == 0) {\r\n                // or start phase if they are first rounds\r\n                this.rounds[roundIndex].scheduledAt = phases[0].startDate;\r\n\r\n            } else {\r\n                const previousDates = previousRounds.map(r => {\r\n                    return { date: this.scheduleRound(r.id, config), round: r }\r\n                });\r\n                previousDates.sort((a, b) => {\r\n                    return b.date.getTime() - a.date.getTime();\r\n                }); // dates sorted desc\r\n                const prevStart = moment(previousDates[0].date);\r\n                switch (schedulingMode) {\r\n                    case SchedulingMode.Daily: this.rounds[roundIndex].scheduledAt = prevStart.add(1, 'days').toDate();\r\n                        break;\r\n                    case SchedulingMode.Weekly: this.rounds[roundIndex].scheduledAt = prevStart.add(1, 'weeks').toDate();\r\n                        break;\r\n                    case SchedulingMode.Monthly: this.rounds[roundIndex].scheduledAt = prevStart.add(1, 'months').toDate();\r\n                        break;\r\n                    case SchedulingMode.Direct:\r\n                    default:\r\n                        const lengthSetting = matchLengthSettings.find(l => l.numberOfGames == previousDates[0].round.roundLength) || { matchLengthMin: 30, numberOfGames: 1 };\r\n                        this.rounds[roundIndex].scheduledAt = prevStart.add(lengthSetting.matchLengthMin, 'minutes').toDate();\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.rounds[roundIndex].scheduledAt!;\r\n    }\r\n}","import React from 'react';\r\nimport {\r\n    Stepper, Step, StepLabel, Typography, TextField, Button, withStyles, createStyles, Theme,\r\n    List, ListItem, ListItemText, CircularProgress, Grid\r\n} from '@material-ui/core';\r\nimport ToornamentHelper from './ToornamentHelper';\r\nimport CredentialsStep from './CredentialsStep';\r\nimport ConfigurationStep, { ScheduleConfig, SchedulingMode } from './ConfigurationStep';\r\nimport TournamentStructure from './TournamenStructure';\r\nimport FetchDialog from './FetchDialog';\r\nimport ReviewSchedule from './ReviewSchedule';\r\nimport ApplyDialog from './ApplyDialog';\r\n\r\nconst tournamentIdItemName = 'tss_i_ti';\r\nconst stageIdItemName = 'tss_i_si';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    root: {\r\n        width: '90%',\r\n    },\r\n    button: {\r\n        marginRight: theme.spacing(1),\r\n    },\r\n    instructions: {\r\n        marginTop: theme.spacing(1),\r\n        marginBottom: theme.spacing(1),\r\n    },\r\n    toorImg: {\r\n        maxWidth: 250,\r\n    }\r\n});\r\n\r\ninterface ScheduleStage {\r\n    id: string;\r\n    name: string;\r\n    number: number;\r\n    size: number;\r\n    type: string;\r\n}\r\n\r\nexport enum BracketType {\r\n    Bracket,\r\n    Rounds,\r\n}\r\n\r\nexport interface ScheduleGroup {\r\n    id: string;\r\n    name: string;\r\n    number: number;\r\n}\r\n\r\nexport interface ScheduleRound {\r\n    id: string;\r\n    groupId: string;\r\n    name: string;\r\n    number: number;\r\n    size: number;\r\n    scheduledAt: Date | null;\r\n    roundLength: number;\r\n}\r\n\r\nexport interface ScheduleMatchOpponent {\r\n    number: number;\r\n    sourceNodeId: string;\r\n    sourceType: string;\r\n}\r\n\r\nexport interface ScheduleMatch {\r\n    id: string;\r\n    roundId: string;\r\n    groupId: string;\r\n    numberOfGames: number;\r\n    opponents: ScheduleMatchOpponent[];\r\n}\r\n\r\ninterface ScheduleStepperState {\r\n    activeStep: number;\r\n    credentialsReady: boolean;\r\n    tournamentId: string;\r\n    stages: ScheduleStage[];\r\n    stageId: string;\r\n    scheduleConfig: ScheduleConfig;\r\n    structure: TournamentStructure;\r\n    fetching: boolean;\r\n    fetchDialogOpen: boolean;\r\n    applyOpen: boolean;\r\n    applyProgress: number;\r\n    applyTotal: number;\r\n}\r\n\r\ninterface ScheduleStepperProps {\r\n    toornamentHelper: ToornamentHelper;\r\n    classes?: any;\r\n}\r\n\r\nclass ScheduleStepper extends React.Component<ScheduleStepperProps, ScheduleStepperState> {\r\n    steps = ['Credentials', 'Tournament', 'Stage', 'Configuration', 'Review'];\r\n\r\n    constructor(props: ScheduleStepperProps) {\r\n        super(props);\r\n\r\n        const credentialsReady = props.toornamentHelper.hasApiKey() && props.toornamentHelper.tokenIsValid();\r\n        this.state = {\r\n            activeStep: credentialsReady ? 1 : 0,\r\n            credentialsReady: credentialsReady,\r\n            tournamentId: sessionStorage.getItem(tournamentIdItemName) || '',\r\n            stages: [],\r\n            stageId: sessionStorage.getItem(stageIdItemName) || '',\r\n            scheduleConfig: {\r\n                schedulingMode: SchedulingMode.Direct,\r\n                matchLengthSettings: [{ numberOfGames: 3, matchLengthMin: 30 }, { numberOfGames: 5, matchLengthMin: 45 }],\r\n                phases: [],\r\n                bracketType: BracketType.Bracket,\r\n            },\r\n            structure: new TournamentStructure([], [], [], BracketType.Bracket),\r\n            fetching: false,\r\n            fetchDialogOpen: false,\r\n            applyOpen: false,\r\n            applyProgress: 0,\r\n            applyTotal: 0,\r\n        }\r\n    }\r\n\r\n    handleNext = () => {\r\n        switch (this.state.activeStep) {\r\n            case 1:\r\n                this.setState({ fetching: true });\r\n                this.props.toornamentHelper.getOrganizerStages(this.state.tournamentId, (results: any[]) => {\r\n                    console.log(results);\r\n                    const stages: ScheduleStage[] = results.map(result => {\r\n                        return {\r\n                            id: result.id,\r\n                            name: result.name,\r\n                            number: result.number,\r\n                            size: result.settings.size,\r\n                            type: result.type,\r\n                        };\r\n                    });\r\n                    this.setState({ stages: stages, activeStep: this.state.activeStep + 1, fetching: false });\r\n                });\r\n                break;\r\n            case 2:\r\n                const stage: ScheduleStage = this.state.stages.find(stage => stage.id == this.state.stageId)!;\r\n                const newScheduleConfig = this.state.scheduleConfig;\r\n                switch (stage.type) {\r\n                    case 'single_elimination':\r\n                    case 'double_elimination':\r\n                    case 'gauntlet':\r\n                    case 'ffa_single_elimination':\r\n                        newScheduleConfig.schedulingMode = SchedulingMode.Direct;\r\n                        newScheduleConfig.bracketType = BracketType.Bracket;\r\n                        break;\r\n                    case 'bracket_groups':\r\n                    case 'pools':\r\n                    case 'league':\r\n                    case 'swiss':\r\n                    case 'simple':\r\n                    case 'ffa_bracket_groups':\r\n                    default:\r\n                        newScheduleConfig.schedulingMode = SchedulingMode.Weekly;\r\n                        newScheduleConfig.bracketType = BracketType.Rounds;\r\n                        break;\r\n                }\r\n\r\n                this.setState({\r\n                    scheduleConfig: newScheduleConfig,\r\n                    fetching: true,\r\n                    fetchDialogOpen: true,\r\n                });\r\n                break;\r\n            case 3:\r\n                this.setState({ fetching: true });\r\n                this.state.structure.scheduleTournament(this.state.scheduleConfig);\r\n                this.setState({ fetching: false, activeStep: this.state.activeStep + 1 });\r\n                break;\r\n            case 4:\r\n                this.setState({ fetching: true });\r\n                this.applySchedule(() => this.setState({ fetching: false, activeStep: this.state.activeStep + 1, applyOpen: false }));\r\n                break;\r\n            default:\r\n                this.setState({ activeStep: this.state.activeStep + 1 });\r\n                break;\r\n        }\r\n\r\n    };\r\n\r\n    applySchedule = (callback: () => void) => {\r\n        const matches = this.state.structure.getMatches();\r\n        const rounds = this.state.structure.getRounds();\r\n        this.setState({ applyOpen: true, applyTotal: matches.length, applyProgress: 0 });\r\n        let currentIndex = 0;\r\n        const scheduleNext = () => {\r\n            if (currentIndex >= matches.length) {\r\n                callback();\r\n                return;\r\n            }\r\n\r\n            const match = matches[currentIndex];\r\n            const round = rounds.find(round => round.id == match.roundId) || rounds[0];\r\n            const continueApplying = () => {\r\n                currentIndex++;\r\n                this.setState({ applyProgress: currentIndex })\r\n                scheduleNext();\r\n            }\r\n\r\n            if (round.scheduledAt == null) {\r\n                continueApplying();\r\n                return;\r\n            }\r\n\r\n            this.props.toornamentHelper.scheduleMatch(this.state.tournamentId, match.id, round.scheduledAt, (result: any, requestStatus: number) => {\r\n                if (requestStatus < 200 || requestStatus > 300) {\r\n                    console.log(result);\r\n                }\r\n\r\n                continueApplying();\r\n            });\r\n        }\r\n        scheduleNext();\r\n    }\r\n\r\n    fetchCallback = (rounds: ScheduleRound[], matches: ScheduleMatch[], groups: ScheduleGroup[]) => {\r\n        const newScheduleConfig = this.state.scheduleConfig;\r\n        const gameLengths: number[] = [];\r\n        matches.forEach(match => {\r\n            if (gameLengths.findIndex(n => n == match.numberOfGames) < 0) {\r\n                gameLengths.push(match.numberOfGames);\r\n            }\r\n\r\n            const roundIndex = rounds.findIndex(round => round.id == match.roundId);\r\n            if (roundIndex >= 0 && rounds[roundIndex].roundLength < match.numberOfGames) {\r\n                rounds[roundIndex].roundLength = match.numberOfGames;\r\n            }\r\n        });\r\n\r\n        newScheduleConfig.matchLengthSettings = gameLengths.map(length => {\r\n            return { numberOfGames: length, matchLengthMin: 30 };\r\n        });\r\n\r\n        const structure = new TournamentStructure(rounds, groups, matches, newScheduleConfig.bracketType);\r\n        const firstRounds = structure.getFirstRounds();\r\n\r\n        newScheduleConfig.phases = firstRounds.map(round => {\r\n            return {\r\n                startingRoundId: round.id,\r\n                groupId: round.groupId,\r\n                startDate: new Date(),\r\n                isFirst: true,\r\n            };\r\n        });\r\n\r\n        this.setState({\r\n            activeStep: this.state.activeStep + 1,\r\n            scheduleConfig: newScheduleConfig,\r\n            structure: structure,\r\n            fetching: false,\r\n            fetchDialogOpen: false,\r\n        });\r\n    }\r\n\r\n    handleBack = () => {\r\n        if (this.state.activeStep == 0) {\r\n            return;\r\n        }\r\n\r\n        this.setState({ activeStep: this.state.activeStep - 1 });\r\n    };\r\n\r\n    handleReset = () => {\r\n        this.setState({ activeStep: 0 });\r\n    };\r\n\r\n    handleChangeTournamentId = (event: any) => {\r\n        const tournamentId = event.target.value;\r\n        sessionStorage.setItem(tournamentIdItemName, tournamentId)\r\n        this.setState({ tournamentId: tournamentId });\r\n    }\r\n\r\n    handleChangeStageId = (event: any) => {\r\n        const stageId = event.target.value;\r\n        sessionStorage.setItem(stageIdItemName, stageId)\r\n        this.setState({ stageId: stageId });\r\n    }\r\n\r\n    canProceed = (): boolean => {\r\n        switch (this.state.activeStep) {\r\n            case 0:\r\n                return this.state.credentialsReady;\r\n            case 1:\r\n                return this.state.tournamentId != '';\r\n            case 2:\r\n                return this.state.stageId != '';\r\n            default:\r\n                return true;\r\n        }\r\n    }\r\n\r\n    getStepContent = (step: number) => {\r\n        const { classes } = this.props;\r\n        switch (step) {\r\n            case 0:\r\n                return <CredentialsStep toornamentHelper={this.props.toornamentHelper} credentialsUpdated={this.credentialsUpdated} />;\r\n            case 1:\r\n                return (\r\n                    <div>\r\n                        <TextField\r\n                            label='Tournament Id'\r\n                            className={classes.textField}\r\n                            value={this.state.tournamentId}\r\n                            onChange={this.handleChangeTournamentId}\r\n                            margin='dense'\r\n                            variant='outlined'\r\n                        />\r\n                        <Typography>Enter the tournament id.</Typography>\r\n                        <Typography variant='caption' display='block'>You will find it in the Link to your tournament. In this example the higlighted part is the tournament id:</Typography>\r\n                        <Typography variant='caption' display='block'>\r\n                            https://www.toornament.com/en_US/tournaments/\r\n                                <Typography variant='caption' color='secondary' display='inline'>2859636902129573888</Typography>\r\n                            /information\r\n                        </Typography>\r\n                    </div>\r\n                );\r\n            case 2:\r\n                return (\r\n                    <div>\r\n                        <List>\r\n                            {this.state.stages.map((stage, index) => {\r\n                                return (\r\n                                    <ListItem\r\n                                        button\r\n                                        selected={this.state.stageId == stage.id}\r\n                                        onClick={() => this.setState({ stageId: stage.id })}\r\n                                        key={`stage-${index}`}\r\n                                    >\r\n                                        <ListItemText primary={`${stage.number}. ${stage.name}`} secondary={`${stage.size} Teams`} />\r\n                                    </ListItem>\r\n                                );\r\n                            })}\r\n                        </List>\r\n                        <FetchDialog\r\n                            open={this.state.fetchDialogOpen}\r\n                            tournamentId={this.state.tournamentId}\r\n                            stageId={this.state.stageId}\r\n                            callback={this.fetchCallback}\r\n                            toornamentHelper={this.props.toornamentHelper}\r\n                        />\r\n                    </div>\r\n                );\r\n            case 3:\r\n                return (\r\n                    <ConfigurationStep\r\n                        config={this.state.scheduleConfig}\r\n                        scheduleConfigChanged={this.scheduleConfigChanged}\r\n                        structure={this.state.structure}\r\n                    />\r\n                );\r\n            case 4:\r\n                return (\r\n                    <ReviewSchedule structure={this.state.structure} />\r\n                );\r\n            default:\r\n                return <div></div>;\r\n        }\r\n    }\r\n\r\n    scheduleConfigChanged = (config: ScheduleConfig) => {\r\n        this.setState({ scheduleConfig: config });\r\n    }\r\n\r\n    credentialsUpdated = () => {\r\n        const credentialsReady = this.props.toornamentHelper.hasApiKey() && this.props.toornamentHelper.tokenIsValid();\r\n        this.setState({ credentialsReady: credentialsReady });\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n        return (\r\n            <div className={classes.root} >\r\n                <Stepper activeStep={this.state.activeStep}>\r\n                    {this.steps.map((label, index) => {\r\n                        const stepProps: { completed?: boolean } = {};\r\n                        const labelProps: { optional?: React.ReactNode } = {};\r\n                        return (\r\n                            <Step key={label} {...stepProps}>\r\n                                <StepLabel {...labelProps}>{label}</StepLabel>\r\n                            </Step>\r\n                        );\r\n                    })}\r\n                </Stepper>\r\n                <div>\r\n                    {this.state.activeStep === this.steps.length ? (\r\n                        <div>\r\n                            <Typography className={classes.instructions}>\r\n                                Your stage has beeen scheduled. If you want to schedule another stage press the button below.\r\n                            </Typography>\r\n                            <Button onClick={this.handleReset} className={classes.button}>\r\n                                Back to start.\r\n                            </Button>\r\n                        </div>\r\n                    ) : (\r\n                            <div>\r\n                                <div className={classes.instructions}>{this.getStepContent(this.state.activeStep)}</div>\r\n                                <Grid\r\n                                    container\r\n                                    alignContent='center'\r\n                                    direction='row'\r\n                                >\r\n                                    <Button disabled={this.state.activeStep === 0} onClick={this.handleBack} className={classes.button}>\r\n                                        Back\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant='contained'\r\n                                        color='primary'\r\n                                        onClick={this.handleNext}\r\n                                        className={classes.button}\r\n                                        disabled={!this.canProceed()}\r\n                                    >\r\n                                        {this.state.activeStep === this.steps.length - 1 ? 'Finish' : 'Next'}\r\n                                    </Button>\r\n                                    <div\r\n                                        hidden={!this.state.fetching}\r\n                                    >\r\n                                        <CircularProgress size={30} thickness={5} />\r\n                                    </div>\r\n                                </Grid>\r\n                            </div>\r\n                        )}\r\n                </div>\r\n                <ApplyDialog open={this.state.applyOpen} progress={this.state.applyProgress} total={this.state.applyTotal} />\r\n                <img src={'./PoweredbyToor_Black.png'} className={classes.toorImg}></img>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(ScheduleStepper);","import React from 'react';\r\nimport { Dialog, DialogTitle, Grid, CircularProgress, Typography, Theme, createStyles, withStyles, DialogContent } from '@material-ui/core';\r\nimport ToornamentHelper from \"./ToornamentHelper\";\r\nimport { ScheduleRound, ScheduleMatch, ScheduleGroup } from \"./ScheduleStepper\";\r\nimport CheckIcon from '@material-ui/icons/Check';\r\nimport { green } from '@material-ui/core/colors';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    checkIcon: {\r\n        color: green[300],\r\n    },\r\n    iconContainer: {\r\n        width: 20,\r\n        marginRight: theme.spacing(1),\r\n    },\r\n});\r\n\r\ninterface FetchDialogProps {\r\n    open: boolean;\r\n    tournamentId: string;\r\n    stageId: string;\r\n    toornamentHelper: ToornamentHelper;\r\n    callback: (rounds: ScheduleRound[], matches: ScheduleMatch[], groups: ScheduleGroup[]) => void;\r\n    classes?: any;\r\n}\r\n\r\ninterface FetchDialogState {\r\n    roundsFinished: boolean;\r\n    matchesFinished: boolean;\r\n    groupsFinished: boolean;\r\n    rounds: ScheduleRound[];\r\n    matches: ScheduleMatch[];\r\n    groups: ScheduleGroup[];\r\n    matchIndex: number;\r\n    bracketNodeIndex: number,\r\n}\r\n\r\nfunction getDefaultFetchDialogState(): FetchDialogState {\r\n    return {\r\n        roundsFinished: false,\r\n        matchesFinished: false,\r\n        groupsFinished: false,\r\n        rounds: [],\r\n        matches: [],\r\n        groups: [],\r\n        matchIndex: 0,\r\n        bracketNodeIndex: 0,\r\n    }\r\n}\r\n\r\nclass FetchDialog extends React.Component<FetchDialogProps, FetchDialogState> {\r\n    fetchOnUpdate: boolean = false;\r\n\r\n    constructor(props: FetchDialogProps) {\r\n        super(props);\r\n\r\n        this.state = getDefaultFetchDialogState();\r\n    }\r\n\r\n    fetchStageData() {\r\n        const { tournamentId, stageId, toornamentHelper, callback } = this.props;\r\n\r\n        toornamentHelper.getOrganizerGroups(tournamentId, stageId, (results: any[]) => {\r\n            const groups = results.map(result => {\r\n                return {\r\n                    id: result.id,\r\n                    name: result.name,\r\n                    number: result.number,\r\n                };\r\n            });\r\n\r\n            this.setState({ groups: groups, groupsFinished: true });\r\n\r\n            if (this.state.roundsFinished && this.state.matchesFinished) {\r\n                callback(this.state.rounds, this.state.matches, this.state.groups);\r\n            }\r\n        });\r\n\r\n        toornamentHelper.getOrganizerRounds(tournamentId, stageId, (results: any[]) => {\r\n            const rounds = results.map(result => {\r\n                return {\r\n                    id: result.id,\r\n                    groupId: result.group_id,\r\n                    name: result.name,\r\n                    number: result.number,\r\n                    size: result.settings.size,\r\n                    scheduledAt: null,\r\n                    roundLength: 1,\r\n                };\r\n            });\r\n\r\n            this.setState({ rounds: rounds, roundsFinished: true });\r\n\r\n            if (this.state.matchesFinished && this.state.groupsFinished) {\r\n                callback(this.state.rounds, this.state.matches, this.state.groups);\r\n            }\r\n        });\r\n\r\n        toornamentHelper.getOrganizerMatches(tournamentId, stageId, (matchResults: any[]) => {\r\n            const matches = matchResults.map(result => {\r\n                return {\r\n                    id: result.id,\r\n                    groupId: result.group_id,\r\n                    roundId: result.round_id,\r\n                    numberOfGames: 0,\r\n                    opponents: []\r\n                }\r\n            });\r\n\r\n            this.setState({ matches: matches });\r\n\r\n            const finishMatches = () => {\r\n                if (this.state.roundsFinished && this.state.groupsFinished) {\r\n                    callback(this.state.rounds, this.state.matches, this.state.groups);\r\n                }\r\n                else {\r\n                    this.setState({ matchesFinished: true });\r\n                }\r\n            }\r\n\r\n            const getNodes = () => {\r\n                toornamentHelper.getBracketNodes(tournamentId, stageId, (results: any[]) => {\r\n                    results.forEach((result, index) => {\r\n                        let matchIndex = index;\r\n                        const matches = this.state.matches;\r\n                        let match = matches[matchIndex];\r\n\r\n                        if (match == null || match.id != result.id) {\r\n                            matchIndex = matches.findIndex(m => m.id == result.id);\r\n                            if (matchIndex < 0) {\r\n                                return;\r\n                            }\r\n                            match = matches[matchIndex];\r\n                        }\r\n\r\n                        match.opponents = result.opponents.map((opponent: any) => {\r\n                            return {\r\n                                number: opponent.number,\r\n                                sourceType: opponent.source_type,\r\n                                sourceNodeId: opponent.source_node_id,\r\n                            };\r\n                        });\r\n                        matches[matchIndex] = match;\r\n                        this.setState({ matches: matches, bracketNodeIndex: index + 1 });\r\n                    });\r\n                    finishMatches();\r\n                });\r\n            }\r\n\r\n            const callNext = () => {\r\n                if (this.state.matchIndex >= this.state.matches.length) {\r\n                    getNodes();\r\n                    return;\r\n                }\r\n\r\n                const matchId = this.state.matches[this.state.matchIndex].id;\r\n                const callback = (results: any[]) => {\r\n                    const matches = this.state.matches;\r\n                    matches[this.state.matchIndex].numberOfGames = results.length;\r\n                    this.setState({ matches: matches, matchIndex: this.state.matchIndex + 1 });\r\n                    callNext();\r\n                }\r\n                toornamentHelper.getOrganizerMatchGames(tournamentId, matchId, callback)\r\n            };\r\n\r\n            callNext();\r\n        });\r\n    }\r\n\r\n    componentWillReceiveProps(newProps: FetchDialogProps) {\r\n        if (!this.props.open && newProps.open) {\r\n            this.fetchOnUpdate = true;\r\n        }\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.fetchOnUpdate) {\r\n            this.fetchOnUpdate = false;\r\n            this.setState(getDefaultFetchDialogState());\r\n            this.fetchStageData();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props\r\n        const progressSize = 20;\r\n        return (\r\n            <Dialog open={this.props.open}>\r\n                <DialogTitle>Fetching Tournament Properties...</DialogTitle>\r\n                <DialogContent>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.state.groupsFinished ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>Fetching Groups</Typography>\r\n                    </Grid>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.state.roundsFinished ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>Fetching Rounds</Typography>\r\n                    </Grid>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.state.matches.length != 0 ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>Fetching Matches</Typography>\r\n                    </Grid>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                        hidden={this.state.matches.length == 0}\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.state.matchIndex >= this.state.matches.length ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>{this.state.matchIndex}/{this.state.matches.length} Fetching Match Length</Typography>\r\n                    </Grid>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                        hidden={this.state.matchIndex < this.state.matches.length}\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.state.bracketNodeIndex >= this.state.matches.length ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>{this.state.bracketNodeIndex}/{this.state.matches.length} Fetching Bracket Nodes</Typography>\r\n                    </Grid>\r\n                </DialogContent>\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(FetchDialog);","import React from 'react';\r\nimport {\r\n    createStyles, Theme, withStyles, Table, TableBody, TableRow, TableCell\r\n} from '@material-ui/core';\r\nimport TournamentStructure from './TournamenStructure';\r\nimport { ScheduleRound } from './ScheduleStepper';\r\nimport moment from 'moment';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n\r\n});\r\n\r\ninterface ReviewScheduleProps {\r\n    structure: TournamentStructure;\r\n    classes?: any;\r\n}\r\n\r\nclass ReviewSchedule extends React.Component<ReviewScheduleProps, any> {\r\n    getGroupName = (round: ScheduleRound): string => {\r\n        const group = this.props.structure.getGroups().find(group => group.id == round.groupId);\r\n        return group != undefined ? group.name : 'Unknown Group';\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n\r\n        const tableRows = this.props.structure.getRounds().sort((a, b) => {\r\n            if (a.scheduledAt == null) {\r\n                return -1;\r\n            }\r\n\r\n            if (b.scheduledAt == null) {\r\n                return 1;\r\n            }\r\n\r\n            return a.scheduledAt.getTime() - b.scheduledAt.getTime()\r\n        }).map(round => {\r\n            return (\r\n                <TableRow>\r\n                    <TableCell>\r\n                        {this.getGroupName(round)}\r\n                    </TableCell>\r\n                    <TableCell>\r\n                        {round.name}\r\n                    </TableCell>\r\n                    <TableCell>\r\n                        {round.scheduledAt != null ? moment(round.scheduledAt).format('llll') : 'Error while scheduling, please contact dev.'}\r\n                    </TableCell>\r\n                </TableRow>\r\n            );\r\n        });\r\n\r\n        return (\r\n            <Table>\r\n                <TableBody>\r\n                    {tableRows}\r\n                </TableBody>\r\n            </Table>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(ReviewSchedule);","import React from 'react';\r\nimport { Dialog, DialogTitle, Grid, CircularProgress, Typography, Theme, createStyles, withStyles, DialogContent } from '@material-ui/core';\r\nimport ToornamentHelper from \"./ToornamentHelper\";\r\nimport { ScheduleRound, ScheduleMatch, ScheduleGroup } from \"./ScheduleStepper\";\r\nimport CheckIcon from '@material-ui/icons/Check';\r\nimport { green } from '@material-ui/core/colors';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    checkIcon: {\r\n        color: green[300],\r\n    },\r\n    iconContainer: {\r\n        width: 20,\r\n        marginRight: theme.spacing(1),\r\n    },\r\n});\r\n\r\ninterface FetchDialogProps {\r\n    open: boolean;\r\n    progress: number;\r\n    total: number;\r\n    classes?: any;\r\n}\r\n\r\nclass ApplyDialog extends React.Component<FetchDialogProps, any> {\r\n\r\n    render() {\r\n        const { classes } = this.props\r\n        const progressSize = 20;\r\n        return (\r\n            <Dialog open={this.props.open}>\r\n                <DialogTitle>Applying Changes</DialogTitle>\r\n                <DialogContent>\r\n                    <Grid\r\n                        container\r\n                        direction='row'\r\n                    >\r\n                        <Grid\r\n                            item\r\n                            container\r\n                            alignContent='center'\r\n                            className={classes.iconContainer}\r\n                        >\r\n                            {this.props.progress != this.props.total ? <CheckIcon className={classes.checkIcon} /> : <CircularProgress size={progressSize} />}\r\n                        </Grid>\r\n                        <Typography>{this.props.progress}/{this.props.total} Applying Matches</Typography>\r\n                    </Grid>\r\n                </DialogContent>\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(ApplyDialog);","import React from 'react';\r\nimport {\r\n    createStyles, Theme, withStyles, CssBaseline, Typography, AppBar, Toolbar\r\n} from '@material-ui/core';\r\nimport ToornamentHelper from './ToornamentHelper';\r\nimport ScheduleStepper from './ScheduleStepper';\r\n\r\nconst styles = (theme: Theme) => createStyles({\r\n    root: {\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n    },\r\n    menuButton: {\r\n        marginRight: theme.spacing(2),\r\n    },\r\n    hide: {\r\n        display: 'none',\r\n    },\r\n    content: {\r\n        flexGrow: 1,\r\n        maxWidth: 1000,\r\n        padding: theme.spacing(3),\r\n        marginTop: theme.spacing(6),\r\n    },\r\n    button: {\r\n        marginLeft: 16,\r\n        marginTop: 8,\r\n        marginRight: 16,\r\n        marginBottom: 8,\r\n    },\r\n    paper: {\r\n        width: '100%',\r\n        marginTop: theme.spacing(3),\r\n        overflowX: 'auto',\r\n    },\r\n    table: {\r\n        minWidth: 650,\r\n    },\r\n});\r\n\r\ninterface AppState {\r\n    toornamentHelper: ToornamentHelper,\r\n}\r\n\r\nclass App extends React.Component<any, AppState> {\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            toornamentHelper: new ToornamentHelper(),\r\n        }\r\n    }\r\n\r\n    fetchEverything = () => {\r\n        if (this.state.toornamentHelper.tokenIsValid()) {\r\n            /*\r\n            const matchesCallback = (matchIds: string[]) => {\r\n                let currentIndex = 0;\r\n\r\n\r\n                const callNext = () => {\r\n                    if (currentIndex >= matchIds.length) {\r\n                        return;\r\n                    }\r\n\r\n                    const matchId = matchIds[currentIndex];\r\n                    const callback = (result: any) => {\r\n                        console.log(`games from: ${matchId}`, result);\r\n                        currentIndex++;\r\n                        callNext();\r\n                    }\r\n                    this.state.toornamentHelper.getOrganizerMatchGames(this.state.apiKey, this.state.tournamentId, matchId, callback)\r\n                };\r\n                // callNext();\r\n            }\r\n\r\n            this.state.toornamentHelper.getOrganizerRounds(this.state.apiKey, this.state.tournamentId, this.state.stageId, (results: any[]) => {\r\n                let currentIndex = 0;\r\n                console.log('rounds', results);\r\n\r\n                const callNext = () => {\r\n                    if (currentIndex >= results.length) {\r\n                        return;\r\n                    }\r\n\r\n                    const roundId = results[currentIndex].id;\r\n                    const callback = (result: any) => {\r\n                        console.log(`nodes from round ${roundId}`, result);\r\n                        currentIndex++;\r\n                        callNext();\r\n                    }\r\n\r\n                    this.state.toornamentHelper.getOrganizerBracketNodes(this.state.apiKey, this.state.tournamentId, this.state.stageId, roundId, callback)\r\n                };\r\n\r\n                callNext();\r\n            });\r\n            // this.state.toornamentHelper.getOrganizerStages(this.state.apiKey, this.state.tournamentId);\r\n            // this.state.toornamentHelper.getOrganizerTournament(this.state.apiKey, this.state.tournamentId);\r\n            this.state.toornamentHelper.getOrganizerMatches(this.state.apiKey, this.state.tournamentId, this.state.stageId, matchesCallback);\r\n\r\n        */\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n        \r\n        return (\r\n            <div className={classes.root}>\r\n                <CssBaseline />\r\n                <AppBar\r\n                    position=\"fixed\"\r\n                    className={classes.appBar}\r\n                >\r\n                    <Toolbar variant='dense'>\r\n                        <Typography variant=\"h6\" noWrap>\r\n                            Toornament Smart Schedule\r\n                        </Typography>\r\n                    </Toolbar>\r\n                </AppBar>\r\n                <main\r\n                    className={classes.content}\r\n                >\r\n                    <ScheduleStepper toornamentHelper={this.state.toornamentHelper} />\r\n                </main>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(App);\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}