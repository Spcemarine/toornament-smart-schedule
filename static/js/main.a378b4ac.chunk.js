(window["webpackJsonptoornament-smart-schedule"]=window["webpackJsonptoornament-smart-schedule"]||[]).push([[0],{108:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(11),i=n.n(s),o=n(10),c=n(9),u=n(15),l=n(13),d=n(14),h=n(170),p=n(164),m=n(165),g=n(150),f=n(50),v=n(4),y=n(76),b=n(23),k=n(28),E=n.n(k);function I(e,t){I=function(e,t){return new s(e,void 0,t)};var n=Object(y.a)(RegExp),a=RegExp.prototype,r=new WeakMap;function s(e,t,a){var s=n.call(this,e,t);return r.set(s,a||r.get(e)),s}function i(e,t){var n=r.get(t);return Object.keys(n).reduce((function(t,a){return t[a]=e[n[a]],t}),Object.create(null))}return Object(d.a)(s,n),s.prototype.exec=function(e){var t=a.exec.call(this,e);return t&&(t.groups=i(t,this)),t},s.prototype[Symbol.replace]=function(e,t){if("string"===typeof t){var n=r.get(this);return a[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"===typeof t){var s=this;return a[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==typeof e[e.length-1]&&e.push(i(e,s)),t.apply(this,e)}))}return a[Symbol.replace].call(this,e,t)},I.apply(this,arguments)}var C,O=function(){function e(){Object(o.a)(this,e),this.apiKey=void 0,this.token=void 0,this.apiKey=this.readApiKey(),this.token=this.readToken()}return Object(c.a)(e,[{key:"getToken",value:function(e,t,n){var a=this;if(null==this.apiKey)return!1;var r=new XMLHttpRequest;r.open("POST","https://api.toornament.com/oauth/v2/token"),r.setRequestHeader("X-Api-Key",this.apiKey),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.addEventListener("load",(function(e){var t=JSON.parse(r.responseText);a.updateToken(t.access_token,t.expires_in),n()}));var s="grant_type=client_credentials&client_id=".concat(e,"&client_secret=").concat(t,"&scope=organizer:result");r.send(s)}},{key:"readToken",value:function(){var e=sessionStorage.getItem("tss_t_at");if(null==e)return null;var t=sessionStorage.getItem("tss_t_ed");return null==t?null:{accessToken:e,expireDate:JSON.parse(t)}}},{key:"readApiKey",value:function(){return sessionStorage.getItem("tss_t_ak")}},{key:"updateApiKey",value:function(e){if(""==e)return this.apiKey=null,void sessionStorage.removeItem("tss_t_ak");this.apiKey=e,sessionStorage.setItem("tss_t_ak",e)}},{key:"hasApiKey",value:function(){return null!=this.apiKey&&""!=this.apiKey}},{key:"getApiKey",value:function(){return this.apiKey}},{key:"updateToken",value:function(e,t){var n=E()().add(t,"minutes").toDate();sessionStorage.setItem("tss_t_at",e),sessionStorage.setItem("tss_t_ed",JSON.stringify(n)),this.token={accessToken:e,expireDate:n}}},{key:"tokenIsValid",value:function(){return null!=this.token&&!(this.token.expireDate<new Date)}},{key:"rangedToornamentGETAPICall",value:function(e,t,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50;if(null==this.apiKey)return!1;if(!r&&!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");e.startsWith("/")||(e="/"+e);var c=0,u=o-1,l=o,d=0,h=[],p=function o(p,m,g){m>=200&&m<300?(h.push.apply(h,Object(b.a)(p)),g<=0||p.length>=i&&i>0?n(h):(d+=l,a.makePagedAPIGETCall(e,t,c+d,u+d,o,r,s))):console.error(p)};return this.makePagedAPIGETCall(e,t,c,u,p,r,s),!0}},{key:"makePagedAPIGETCall",value:function(e,t,n,a,r){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];if(null==this.apiKey)return!1;var o=new XMLHttpRequest,c="https://api.toornament.com/".concat(s?"viewer":"organizer","/v2").concat(e);if(o.open("GET",c),o.setRequestHeader("X-Api-Key",this.apiKey),!s){if(!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");o.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken))}o.setRequestHeader("Range","".concat(t,"=").concat(n,"-").concat(a)),i.forEach((function(e){return o.setRequestHeader(e.name,e.value)})),o.addEventListener("load",(function(e){if(o.status>=200&&o.status<300){var t=0,n=JSON.parse(o.responseText),a=I(/.*\s*(\d+)-(\d+)\/(\d+)/,{start:1,end:2,total:3}),s=o.getResponseHeader("Content-Range");if(null!=s){var i=s.match(a);if(null!=i&&i.length>=4){var c=Number(i.groups.end),u=Number(i.groups.total);t=Math.max(t,u-c-1)}}else t=n.length>=50?50:0;r(n,o.status,t)}else r(o.statusText,o.status,NaN)})),o.send()}},{key:"makeAPIGETCall",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(null==this.apiKey)return!1;var r=new XMLHttpRequest,s="https://api.toornament.com/".concat(n?"viewer":"organizer","/v2").concat(e);if(r.open("GET",s),r.setRequestHeader("X-Api-Key",this.apiKey),!n){if(!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");r.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken))}a.forEach((function(e){return r.setRequestHeader(e.name,e.value)})),r.addEventListener("load",(function(e){if(r.status>=200&&r.status<300){var n=JSON.parse(r.responseText);t(n,r.status)}else t(r.statusText,r.status)})),r.send()}},{key:"getOrganizerMatches",value:function(e,t,n){var a="/tournaments/".concat(e,"/matches?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"matches",n)}},{key:"getOrganizerRounds",value:function(e,t,n){var a="/tournaments/".concat(e,"/rounds?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"rounds",n,!1)}},{key:"getOrganizerStages",value:function(e,t){var n="/tournaments/".concat(e,"/stages");this.makeAPIGETCall(n,t,!1)}},{key:"getOrganizerTournament",value:function(e){var t="/tournaments/".concat(e);this.makeAPIGETCall(t,(function(e){console.log(e)}),!1)}},{key:"getOrganizerMatchGames",value:function(e,t,n){var a="/tournaments/".concat(e,"/matches/").concat(t,"/games");this.rangedToornamentGETAPICall(a,"games",n,!1)}},{key:"getBracketNodes",value:function(e,t,n){var a="/tournaments/".concat(e,"/stages/").concat(t,"/bracket-nodes");this.rangedToornamentGETAPICall(a,"nodes",n,!0)}},{key:"getOrganizerGroups",value:function(e,t,n){var a="/tournaments/".concat(e,"/groups?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"groups",n,!1)}},{key:"scheduleMatch",value:function(e,t,n,a){if(null==this.apiKey)return!1;var r="https://api.toornament.com/organizer/v2/tournaments/".concat(e,"/matches/").concat(t),s={scheduled_datetime:E()(n).format("YYYY-MM-DDTHH:mm:ssZ")},i=new XMLHttpRequest;if(i.open("PATCH",r),i.setRequestHeader("X-Api-Key",this.apiKey),!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");i.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken)),i.addEventListener("load",(function(){if(i.status>=200&&i.status<300){var e=JSON.parse(i.responseText);a(e,i.status)}else a(i.statusText,i.status)})),i.send(JSON.stringify(s))}}]),e}(),S=n(171),T=n(148),w=n(110),R=n(162),x=n(175),A=n(163),N=n(168),j=n(149),D=n(140),M=n(152),P=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).handleChangeApiKey=function(e){n.props.toornamentHelper.updateApiKey(e.target.value),n.setState({apiKey:e.target.value}),n.props.credentialsUpdated()},n.handleChangeClientId=function(e){n.setState({clientId:e.target.value})},n.handleChangeClientSecret=function(e){n.setState({clientSecret:e.target.value})},n.requestToken=function(){if(!n.props.toornamentHelper.tokenIsValid()){n.props.toornamentHelper.getToken(n.state.clientId,n.state.clientSecret,(function(){n.props.credentialsUpdated()}))}},n.state={apiKey:e.toornamentHelper.getApiKey()||"",clientId:"",clientSecret:""},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.classes;return r.a.createElement(D.a,{container:!0,direction:"column"},r.a.createElement(S.a,{label:"Api Key",className:e.textField,value:this.state.apiKey,onChange:this.handleChangeApiKey,error:null==this.props.toornamentHelper.getApiKey(),helperText:null==this.props.toornamentHelper.getApiKey()?"You must specify an api key":"",margin:"dense"}),r.a.createElement(S.a,{label:"Client Id",className:e.textField,value:this.state.clientId,onChange:this.handleChangeClientId,margin:"dense"}),r.a.createElement(S.a,{label:"Client Secret",className:e.textField,value:this.state.clientSecret,onChange:this.handleChangeClientSecret,margin:"dense"}),r.a.createElement("div",null,r.a.createElement(j.a,{variant:"contained",color:this.props.toornamentHelper.tokenIsValid()?"default":"primary",className:e.button,onClick:this.requestToken},"Request Token")),r.a.createElement(f.a,{hidden:this.props.toornamentHelper.tokenIsValid()},"You must request a token to proceed."))}}]),t}(r.a.Component),_=Object(v.a)((function(e){return Object(h.a)({textField:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},button:{marginTop:e.spacing(1),marginBottom:e.spacing(1)}})}))(P),F=n(155),H=n(156),L=n(157),G=n(158),K=n(159),B=n(145),z=n(173),q=n(167),W=n(153),V=n(18),U=n(70),Y=n(174),J=n(154),X=n(166),$=n(75),Z=n.n($),Q=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).handleChangeStartDate=function(e){var t=n.props.phase;t.startDate=null==e?e:e.toDate(),n.props.phaseChanged(t)},n.handleChangePhaseRound=function(e){var t=n.props.phase;t.startingRoundId=e.target.value,n.props.phaseChanged(t)},n.handleChangePhaseGroup=function(e){var t=n.props.phase;t.groupId=e.target.value,n.props.phaseChanged(t)},n.handleDelete=function(){n.props.phaseChanged(null)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(D.a,{item:!0,container:!0,direction:"row",alignContent:"center"},r.a.createElement(Y.a,{title:"Select start date"},r.a.createElement("div",null,r.a.createElement(X.a,{disablePast:!0,className:t.textField,ampm:!1,value:this.props.phase.startDate,label:"Phase Start",onChange:this.handleChangeStartDate}))),r.a.createElement(B.a,{className:t.textField},r.a.createElement(z.a,null,"Group"),r.a.createElement(q.a,{value:this.props.phase.groupId,onChange:this.handleChangePhaseGroup,inputProps:{name:"startRound"},disabled:this.props.phase.isFirst},this.props.structure.getGroups().map((function(e,t){return r.a.createElement(W.a,{value:e.id,key:"group-".concat(t,"-mi")},e.name)})))),r.a.createElement(B.a,{className:t.textField},r.a.createElement(z.a,null,"Start Round"),r.a.createElement(q.a,{value:this.props.phase.startingRoundId,onChange:this.handleChangePhaseRound,inputProps:{name:"startRound"},disabled:this.props.phase.isFirst},this.props.structure.getRounds().filter((function(t){return t.groupId==e.props.phase.groupId})).map((function(e,t){return r.a.createElement(W.a,{value:e.id,key:"round-".concat(t,"-mi")},e.name)})))),!this.props.phase.isFirst&&r.a.createElement(J.a,{size:"small","aria-label":"Delete",className:t.delButton,onClick:this.handleDelete},r.a.createElement(Z.a,null)))}}]),t}(r.a.Component),ee=Object(v.a)((function(e){return Object(h.a)({textField:{margin:e.spacing(1),maxWidth:220},delButton:{margin:e.spacing(1)}})}))(Q);!function(e){e.Monthly="Monthly",e.Weekly="Weekly",e.Daily="Daily",e.Direct="Direct"}(C||(C={}));var te=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).renderMatchLengthConfig=function(){var e=n.props.classes;return r.a.createElement(F.a,{className:e.table,size:"small"},r.a.createElement(H.a,null,r.a.createElement(L.a,null,r.a.createElement(G.a,{className:e.tableHeader,align:"right"},"Games per Match"),r.a.createElement(G.a,{className:e.tableHeader},"Time per Match (Minutes)"))),r.a.createElement(K.a,null,n.props.config.matchLengthSettings.map((function(t,a){return r.a.createElement(L.a,{key:"row-".concat(a)},r.a.createElement(G.a,{component:"th",scope:"row",align:"right"},t.numberOfGames),r.a.createElement(G.a,null,r.a.createElement(S.a,{label:"Match Length",className:e.textField,value:t.matchLengthMin,onChange:n.handleChangeMatchLength(a),margin:"dense",variant:"outlined",type:"number",error:!n.isValidMatchLength(t.matchLengthMin)})))}))))},n.handleChangeMatchLength=function(e){return function(t){var a=n.props.config;a.matchLengthSettings[e].matchLengthMin=Number(t.target.value),n.props.scheduleConfigChanged(a)}},n.handleChangeMatchMode=function(e){var t=n.props.config;t.schedulingMode=e.target.value,n.props.scheduleConfigChanged(t)},n.isValidMatchLength=function(e){return e>0&&Number.isInteger(e)},n.onPhaseChanged=function(e){return function(t){var a=n.props.config;null!=t?a.phases[e]=t:a.phases.splice(e,1),n.props.scheduleConfigChanged(a)}},n.addPhase=function(){var e=n.props.config,t=n.props.structure.getRounds().find((function(e){return n.props.config.phases.findIndex((function(t){return t.startingRoundId==e.id}))<0}));void 0!=t&&(e.phases.push({groupId:t.groupId,startingRoundId:t.id,startDate:e.phases[e.phases.length-1].startDate,isFirst:!1}),n.props.scheduleConfigChanged(e))},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"canAddNewPhase",value:function(){return this.props.config.phases.length<this.props.structure.getRounds().length}},{key:"render",value:function(){var e=this,t=this.props.classes,n=[C.Direct,C.Daily,C.Weekly,C.Monthly],a=this.props.config.phases.map((function(t,n){return r.a.createElement(ee,{phase:t,structure:e.props.structure,phaseChanged:e.onPhaseChanged(n),key:"phase-".concat(n)})}));return r.a.createElement(D.a,{container:!0,direction:"column"},r.a.createElement(f.a,{className:t.title,variant:"h6"},"Schedule Mode"),r.a.createElement(f.a,{paragraph:!0},"Decide how rounds should be scheduled. By specifying a mode other than ",C.Direct," you can schedule your matches on a daily, weekly or monthly basis. Each round is going to take place at a new date. In ",C.Direct," mode matches will occur at the earliest time after all previous matches have been played. Therefore it is well suited for brackets."),r.a.createElement(B.a,{className:t.textField},r.a.createElement(z.a,null,"Schedule Mode"),r.a.createElement(q.a,{value:this.props.config.schedulingMode,onChange:this.handleChangeMatchMode,inputProps:{name:"schedulingMode"}},n.map((function(e,t){return r.a.createElement(W.a,{value:e,key:"mode-".concat(t,"-mi")},e)})))),r.a.createElement(f.a,{className:t.title,variant:"h6",component:"div"},"Manage Phases"),r.a.createElement(f.a,null,"You can use Phases to start a part of your tournament at a different time. For example if you wanted to skip a day in your weekly round robin because its christmas eve or something, you would add a new phase starting at the first match day after the skipped day."),r.a.createElement(f.a,null,"This also enables you to use the ",C.Direct," mode to schedule a bracket over the course of two days by adding a phase for the second day."),r.a.createElement(f.a,null,"Please note that the integrety of your structure will not be verified. You are resposible for starting phases at the right time and date. If you do not need to use phases just use the first one as the starting date for your tournament."),r.a.createElement(V.a,{utils:U.a},a,r.a.createElement(j.a,{variant:"contained",color:"primary",onClick:this.addPhase,disabled:!this.canAddNewPhase()},"Add Phase")),r.a.createElement(f.a,{className:t.title,variant:"h6"},"Match Length"),this.renderMatchLengthConfig())}}]),t}(r.a.Component),ne=Object(v.a)((function(e){return Object(h.a)({textField:{marginTop:e.spacing(1),marginRight:e.spacing(2),marginBottom:e.spacing(1),maxWidth:300},button:{marginLeft:e.spacing(2),marginTop:e.spacing(1),marginRight:e.spacing(2),marginBottom:e.spacing(1)},table:{minWidth:450,maxWidth:600},tableHeader:{fontSize:"1em",fontWeight:"bolder",color:e.palette.text.primary},title:{marginTop:e.spacing(3),marginBottom:e.spacing(1),borderBottomColor:e.palette.secondary.main,borderBottomStyle:"solid",borderBottomWidth:4,flexShrink:1}})}))(te),ae=function(){function e(t,n,a,r){Object(o.a)(this,e),this.rounds=void 0,this.groups=void 0,this.matches=void 0,this.bracketType=void 0,this.roundDependencies=void 0,this.rounds=t,this.groups=n,this.matches=a,this.bracketType=r,this.roundDependencies=[],this.createDependencies()}return Object(c.a)(e,[{key:"createDependencies",value:function(){var e=this;this.matches.forEach((function(t,n){var a,r,s=e.roundDependencies.findIndex((function(e){return e.roundId===t.roundId}));s<0&&(s=e.roundDependencies.length,e.roundDependencies.push({roundId:t.roundId,precedingRoundIds:[],followingRoundIds:[]}));var i=e.roundDependencies[s],o=[];t.opponents.map((function(e){return e.sourceNodeId})).filter((function(e){return null!=e})).forEach((function(t){var n=e.matches.find((function(e){return e.id===t}));void 0!==n&&i.precedingRoundIds.findIndex((function(e){return e===n.roundId}))<0&&o.findIndex((function(e){return e===n.roundId}))<0&&o.push(n.roundId)}));var c=e.roundDependencies.filter((function(e){return e.precedingRoundIds.findIndex((function(e){return e===t.roundId}))>=0})).map((function(e){return e.roundId}));c=c.filter((function(e){return i.followingRoundIds.findIndex((function(t){return e===t}))<0})),(a=e.roundDependencies[s].precedingRoundIds).push.apply(a,o),(r=e.roundDependencies[s].followingRoundIds).push.apply(r,Object(b.a)(c)),o.forEach((function(n){var a=e.roundDependencies.findIndex((function(e){return e.roundId===n}));a>=0&&e.roundDependencies[a].followingRoundIds.findIndex((function(e){return e===t.roundId}))<0&&e.roundDependencies[a].followingRoundIds.push(t.roundId)})),e.roundDependencies[s]=i}))}},{key:"getRounds",value:function(){return this.rounds}},{key:"getMatches",value:function(){return this.matches}},{key:"getGroups",value:function(){return this.groups}},{key:"getFirstRounds",value:function(){var e=this,t=[];switch(this.bracketType){case le.Bracket:this.roundDependencies.filter((function(e){return 0===e.precedingRoundIds.length})).forEach((function(n){var a=e.rounds.find((function(e){return e.id===n.roundId}));void 0!==a&&t.push(a)}));break;default:case le.Rounds:this.groups.forEach((function(n){var a=e.rounds.find((function(e){return e.groupId===n.id}));void 0!==a&&t.push(a)}))}return t}},{key:"getFollowingRounds",value:function(e){var t=this.roundDependencies.find((function(t){return t.roundId===e}));return void 0===t?[]:this.rounds.filter((function(e){return t.followingRoundIds.findIndex((function(t){return t===e.id}))>=0}))}},{key:"getPrecedingRounds",value:function(e){var t=this,n=[];switch(this.bracketType){case le.Bracket:var a=this.roundDependencies.find((function(t){return t.roundId===e}));if(void 0===a)break;n=this.rounds.filter((function(e){return a.precedingRoundIds.findIndex((function(t){return t===e.id}))>=0}));break;case le.Rounds:default:this.groups.map((function(e){return t.rounds.filter((function(t){return t.groupId===e.id}))})).forEach((function(t){var a=t.findIndex((function(t){return t.id===e}));a>0&&n.push(t[a-1])}))}return n}},{key:"getLastRounds",value:function(){var e=this;return this.rounds.filter((function(t){return e.roundDependencies.findIndex((function(e){return e.roundId===t.id&&0===e.followingRoundIds.length}))>=0}))}},{key:"scheduleTournament",value:function(e){var t=this;this.getLastRounds().forEach((function(n){return t.scheduleRound(n.id,e)})),this.matches.forEach((function(n){return t.scheduleMatch(n.id,e)}))}},{key:"scheduleRound",value:function(e,t){var n=this,a=t.matchLengthSettings,r=t.phases,s=t.schedulingMode,i=this.rounds.findIndex((function(t){return t.id===e}));if(i<0)throw new Error("Round must be in TournamentStructure.");var o=this.rounds[i],c=r.find((function(e){return e.startingRoundId===o.id})),u=this.getPrecedingRounds(o.id);if(void 0!==c)this.rounds[i].scheduledAt=c.startDate,u.forEach((function(e){return n.scheduleRound(e.id,t)}));else if(0===u.length)this.rounds[i].scheduledAt=r[0].startDate;else{var l=u.map((function(e){return{date:n.scheduleRound(e.id,t),round:e}}));l.sort((function(e,t){return t.date.getTime()-e.date.getTime()}));var d=E()(l[0].date);switch(s){case C.Daily:this.rounds[i].scheduledAt=d.add(1,"days").toDate();break;case C.Weekly:this.rounds[i].scheduledAt=d.add(1,"weeks").toDate();break;case C.Monthly:this.rounds[i].scheduledAt=d.add(1,"months").toDate();break;case C.Direct:default:var h=a.find((function(e){return e.numberOfGames===l[0].round.roundLength}))||{matchLengthMin:30,numberOfGames:1};this.rounds[i].scheduledAt=d.add(h.matchLengthMin,"minutes").toDate()}}return this.rounds[i].scheduledAt}},{key:"scheduleMatch",value:function(e,t){var n=t.matchLengthSettings,a=this.matches.findIndex((function(t){return t.id===e}));if(a<0)throw new Error("Round must be in TournamentStructure.");var r=this.matches[a],s=this.rounds.findIndex((function(e){return e.id===r.roundId}));if(s<0)throw new Error("Round must be in TournamentStructure.");var i=this.rounds[s];if(this.matches[a].scheduledAt=i.scheduledAt,t.schedulingMode!==C.Direct){var o=this.matches.filter((function(e){return e.roundId===r.roundId&&e.id!==r.id&&null!==e.scheduledAt&&e.participants.some((function(e){return r.participants.some((function(t){return e.id===t.id}))}))}));if(o.length>0){o.sort((function(e,t){return t.scheduledAt.getTime()-e.scheduledAt.getTime()}));var c=o[o.length-1],u=E()(c.scheduledAt),l=n.find((function(e){return e.numberOfGames===i.roundLength}))||{matchLengthMin:30,numberOfGames:1};this.matches[a].scheduledAt=u.add(l.matchLengthMin,"minutes").toDate()}}return this.matches[a].scheduledAt}}]),e}(),re=n(169),se=n(161),ie=n(151),oe=n(40),ce=n.n(oe),ue=n(160);var le,de=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).fetchOnUpdate=!1,n.state={roundsFinished:!1,matchesFinished:!1,groupsFinished:!1,rounds:[],matches:[],groups:[],matchIndex:0,bracketNodeIndex:0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"fetchStageData",value:function(){var e=this,t=this.props,n=t.tournamentId,a=t.stageId,r=t.toornamentHelper,s=t.callback;r.getOrganizerGroups(n,a,(function(t){var n=t.map((function(e){return{id:e.id,name:e.name,number:e.number}}));e.setState({groups:n,groupsFinished:!0}),e.state.roundsFinished&&e.state.matchesFinished&&s(e.state.rounds,e.state.matches,e.state.groups)})),r.getOrganizerRounds(n,a,(function(t){var n=t.map((function(e){return{id:e.id,groupId:e.group_id,name:e.name,number:e.number,size:e.settings.size,scheduledAt:null,roundLength:1}}));e.setState({rounds:n,roundsFinished:!0}),e.state.matchesFinished&&e.state.groupsFinished&&s(e.state.rounds,e.state.matches,e.state.groups)})),r.getOrganizerMatches(n,a,(function(t){var i=t.map((function(e){var t=[];return e.opponents.forEach((function(e){e.participant&&t.push({id:e.participant.id,name:e.participant.name})})),{id:e.id,groupId:e.group_id,roundId:e.round_id,numberOfGames:0,scheduledAt:null,opponents:[],participants:t}}));e.setState({matches:i});var o=function(){r.getBracketNodes(n,a,(function(t){t.forEach((function(t,n){var a=n,r=e.state.matches,s=r[a];if(null==s||s.id!==t.id){if((a=r.findIndex((function(e){return e.id===t.id})))<0)return;s=r[a]}s.opponents=t.opponents.map((function(e){return{number:e.number,sourceType:e.source_type,sourceNodeId:e.source_node_id}})),r[a]=s,e.setState({matches:r,bracketNodeIndex:n+1})})),e.state.roundsFinished&&e.state.groupsFinished?s(e.state.rounds,e.state.matches,e.state.groups):e.setState({matchesFinished:!0})}))};!function t(){if(e.state.matchIndex>=e.state.matches.length)o();else{var a=e.state.matches[e.state.matchIndex].id;r.getOrganizerMatchGames(n,a,(function(n){var a=e.state.matches;a[e.state.matchIndex].numberOfGames=n.length,e.setState({matches:a,matchIndex:e.state.matchIndex+1}),t()}))}}()}))}},{key:"componentWillReceiveProps",value:function(e){!this.props.open&&e.open&&(this.fetchOnUpdate=!0)}},{key:"componentDidUpdate",value:function(){this.fetchOnUpdate&&(this.fetchOnUpdate=!1,this.setState({roundsFinished:!1,matchesFinished:!1,groupsFinished:!1,rounds:[],matches:[],groups:[],matchIndex:0,bracketNodeIndex:0}),this.fetchStageData())}},{key:"render",value:function(){var e=this.props.classes;return r.a.createElement(re.a,{open:this.props.open},r.a.createElement(se.a,null,"Fetching Tournament Properties..."),r.a.createElement(ie.a,null,r.a.createElement(D.a,{container:!0,direction:"row"},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.groupsFinished?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,"Fetching Groups")),r.a.createElement(D.a,{container:!0,direction:"row"},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.roundsFinished?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,"Fetching Rounds")),r.a.createElement(D.a,{container:!0,direction:"row"},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},0!==this.state.matches.length?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,"Fetching Matches")),r.a.createElement(D.a,{container:!0,direction:"row",hidden:0===this.state.matches.length},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.matchIndex>=this.state.matches.length?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,this.state.matchIndex,"/",this.state.matches.length," Fetching Match Length")),r.a.createElement(D.a,{container:!0,direction:"row",hidden:this.state.matchIndex<this.state.matches.length},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.bracketNodeIndex>=this.state.matches.length?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,this.state.bracketNodeIndex,"/",this.state.matches.length," Fetching Bracket Nodes"))))}}]),t}(r.a.Component),he=Object(v.a)((function(e){return Object(h.a)({checkIcon:{color:ue.a[300]},iconContainer:{width:20,marginRight:e.spacing(1)}})}))(de),pe=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).getGroupName=function(e){var t=n.props.structure.getGroups().find((function(t){return t.id==e.groupId}));return void 0!=t?t.name:"Unknown Group"},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=(this.props.classes,this.props.structure.getRounds().sort((function(e,t){return null==e.scheduledAt?-1:null==t.scheduledAt?1:e.scheduledAt.getTime()-t.scheduledAt.getTime()})).map((function(t){return r.a.createElement(L.a,null,r.a.createElement(G.a,null,e.getGroupName(t)),r.a.createElement(G.a,null,t.name),r.a.createElement(G.a,null,null!=t.scheduledAt?E()(t.scheduledAt).format("llll"):"Error while scheduling, please contact dev."))})));return r.a.createElement(F.a,null,r.a.createElement(K.a,null,t))}}]),t}(r.a.Component),me=Object(v.a)((function(e){return Object(h.a)({})}))(pe),ge=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.classes;return r.a.createElement(re.a,{open:this.props.open},r.a.createElement(se.a,null,"Applying Changes"),r.a.createElement(ie.a,null,r.a.createElement(D.a,{container:!0,direction:"row"},r.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.props.progress!=this.props.total?r.a.createElement(ce.a,{className:e.checkIcon}):r.a.createElement(M.a,{size:20})),r.a.createElement(f.a,null,this.props.progress,"/",this.props.total," Applying Matches"))))}}]),t}(r.a.Component),fe=Object(v.a)((function(e){return Object(h.a)({checkIcon:{color:ue.a[300]},iconContainer:{width:20,marginRight:e.spacing(1)}})}))(ge),ve="tss_i_ti",ye="tss_i_si";!function(e){e[e.Bracket=0]="Bracket",e[e.Rounds=1]="Rounds"}(le||(le={}));var be=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).steps=["Credentials","Tournament","Stage","Configuration","Review"],n.handleNext=function(){switch(n.state.activeStep){case 1:n.setState({fetching:!0}),n.props.toornamentHelper.getOrganizerStages(n.state.tournamentId,(function(e){console.log(e);var t=e.map((function(e){return{id:e.id,name:e.name,number:e.number,size:e.settings.size,type:e.type}}));n.setState({stages:t,activeStep:n.state.activeStep+1,fetching:!1})}));break;case 2:var e=n.state.stages.find((function(e){return e.id===n.state.stageId})),t=n.state.scheduleConfig;switch(e.type){case"single_elimination":case"double_elimination":case"gauntlet":case"ffa_single_elimination":t.schedulingMode=C.Direct,t.bracketType=le.Bracket;break;case"bracket_groups":case"pools":case"league":case"swiss":case"simple":case"ffa_bracket_groups":default:t.schedulingMode=C.Weekly,t.bracketType=le.Rounds}n.setState({scheduleConfig:t,fetching:!0,fetchDialogOpen:!0});break;case 3:n.setState({fetching:!0}),n.state.structure.scheduleTournament(n.state.scheduleConfig),n.setState({fetching:!1,activeStep:n.state.activeStep+1});break;case 4:n.setState({fetching:!0}),n.applySchedule((function(){return n.setState({fetching:!1,activeStep:n.state.activeStep+1,applyOpen:!1})}));break;default:n.setState({activeStep:n.state.activeStep+1})}},n.applySchedule=function(e){var t=n.state.structure.getMatches(),a=n.state.structure.getRounds();n.setState({applyOpen:!0,applyTotal:t.length,applyProgress:0});var r=0;!function s(){if(r>=t.length)e();else{var i=t[r],o=a.find((function(e){return e.id===i.roundId}))||a[0],c=function(){r++,n.setState({applyProgress:r}),s()};null!==o.scheduledAt||null!==i.scheduledAt?n.props.toornamentHelper.scheduleMatch(n.state.tournamentId,i.id,i.scheduledAt||o.scheduledAt,(function(e,t){(t<200||t>300)&&console.log(e),c()})):c()}}()},n.fetchCallback=function(e,t,a){var r=n.state.scheduleConfig,s=[];t.forEach((function(t){s.findIndex((function(e){return e===t.numberOfGames}))<0&&s.push(t.numberOfGames);var n=e.findIndex((function(e){return e.id===t.roundId}));n>=0&&e[n].roundLength<t.numberOfGames&&(e[n].roundLength=t.numberOfGames)})),r.matchLengthSettings=s.map((function(e){return{numberOfGames:e,matchLengthMin:30}}));var i=new ae(e,a,t,r.bracketType),o=i.getFirstRounds();r.phases=o.map((function(e){return{startingRoundId:e.id,groupId:e.groupId,startDate:new Date,isFirst:!0}})),n.setState({activeStep:n.state.activeStep+1,scheduleConfig:r,structure:i,fetching:!1,fetchDialogOpen:!1})},n.handleBack=function(){0!==n.state.activeStep&&n.setState({activeStep:n.state.activeStep-1})},n.handleReset=function(){n.setState({activeStep:0})},n.handleChangeTournamentId=function(e){var t=e.target.value;sessionStorage.setItem(ve,t),n.setState({tournamentId:t})},n.handleChangeStageId=function(e){var t=e.target.value;sessionStorage.setItem(ye,t),n.setState({stageId:t})},n.canProceed=function(){switch(n.state.activeStep){case 0:return n.state.credentialsReady;case 1:return""!==n.state.tournamentId;case 2:return""!==n.state.stageId;default:return!0}},n.getStepContent=function(e){var t=n.props.classes;switch(e){case 0:return r.a.createElement(_,{toornamentHelper:n.props.toornamentHelper,credentialsUpdated:n.credentialsUpdated});case 1:return r.a.createElement("div",null,r.a.createElement(S.a,{label:"Tournament Id",className:t.textField,value:n.state.tournamentId,onChange:n.handleChangeTournamentId,margin:"dense",variant:"outlined"}),r.a.createElement(f.a,null,"Enter the tournament id."),r.a.createElement(f.a,{variant:"caption",display:"block"},"You will find it in the Link to your tournament. In this example the higlighted part is the tournament id:"),r.a.createElement(f.a,{variant:"caption",display:"block"},"https://www.toornament.com/en_US/tournaments/",r.a.createElement(f.a,{variant:"caption",color:"secondary",display:"inline"},"2859636902129573888"),"/information"));case 2:return r.a.createElement("div",null,r.a.createElement(T.a,null,n.state.stages.map((function(e,t){return r.a.createElement(w.a,{button:!0,selected:n.state.stageId===e.id,onClick:function(){return n.setState({stageId:e.id})},key:"stage-".concat(t)},r.a.createElement(R.a,{primary:"".concat(e.number,". ").concat(e.name),secondary:"".concat(e.size," Teams")}))}))),r.a.createElement(he,{open:n.state.fetchDialogOpen,tournamentId:n.state.tournamentId,stageId:n.state.stageId,callback:n.fetchCallback,toornamentHelper:n.props.toornamentHelper}));case 3:return r.a.createElement(ne,{config:n.state.scheduleConfig,scheduleConfigChanged:n.scheduleConfigChanged,structure:n.state.structure});case 4:return r.a.createElement(me,{structure:n.state.structure});default:return r.a.createElement("div",null)}},n.scheduleConfigChanged=function(e){n.setState({scheduleConfig:e})},n.credentialsUpdated=function(){var e=n.props.toornamentHelper.hasApiKey()&&n.props.toornamentHelper.tokenIsValid();n.setState({credentialsReady:e})};var a=e.toornamentHelper.hasApiKey()&&e.toornamentHelper.tokenIsValid();return n.state={activeStep:a?1:0,credentialsReady:a,tournamentId:sessionStorage.getItem(ve)||"",stages:[],stageId:sessionStorage.getItem(ye)||"",scheduleConfig:{schedulingMode:C.Direct,matchLengthSettings:[{numberOfGames:3,matchLengthMin:30},{numberOfGames:5,matchLengthMin:45}],phases:[],bracketType:le.Bracket},structure:new ae([],[],[],le.Bracket),fetching:!1,fetchDialogOpen:!1,applyOpen:!1,applyProgress:0,applyTotal:0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.classes;return r.a.createElement("div",{className:e.root},r.a.createElement(x.a,{activeStep:this.state.activeStep},this.steps.map((function(e,t){return r.a.createElement(A.a,Object.assign({key:e},{}),r.a.createElement(N.a,{},e))}))),r.a.createElement("div",null,this.state.activeStep===this.steps.length?r.a.createElement("div",null,r.a.createElement(f.a,{className:e.instructions},"Your stage has beeen scheduled. If you want to schedule another stage press the button below."),r.a.createElement(j.a,{onClick:this.handleReset,className:e.button},"Back to start.")):r.a.createElement("div",null,r.a.createElement("div",{className:e.instructions},this.getStepContent(this.state.activeStep)),r.a.createElement(D.a,{container:!0,alignContent:"center",direction:"row"},r.a.createElement(j.a,{disabled:0===this.state.activeStep,onClick:this.handleBack,className:e.button},"Back"),r.a.createElement(j.a,{variant:"contained",color:"primary",onClick:this.handleNext,className:e.button,disabled:!this.canProceed()},this.state.activeStep===this.steps.length-1?"Finish":"Next"),r.a.createElement("div",{hidden:!this.state.fetching},r.a.createElement(M.a,{size:30,thickness:5}))))),r.a.createElement(fe,{open:this.state.applyOpen,progress:this.state.applyProgress,total:this.state.applyTotal}),r.a.createElement("img",{src:"./PoweredbyToor_Black.png",className:e.toorImg,alt:"Powered By Toornament"}),r.a.createElement(f.a,{variant:"body2",color:"textSecondary"},Object({NODE_ENV:"production",PUBLIC_URL:"/toornament-smart-schedule"}).REACT_APP_VERSION||"Version not found"))}}]),t}(r.a.Component),ke=Object(v.a)((function(e){return Object(h.a)({root:{width:"90%"},button:{marginRight:e.spacing(1)},instructions:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},toorImg:{maxWidth:250}})}))(be),Ee=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).fetchEverything=function(){n.state.toornamentHelper.tokenIsValid()},n.state={toornamentHelper:new O},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.classes;return r.a.createElement("div",{className:e.root},r.a.createElement(p.a,null),r.a.createElement(m.a,{position:"fixed",className:e.appBar},r.a.createElement(g.a,{variant:"dense"},r.a.createElement(f.a,{variant:"h6",noWrap:!0},"Toornament Smart Schedule"))),r.a.createElement("main",{className:e.content},r.a.createElement(ke,{toornamentHelper:this.state.toornamentHelper})))}}]),t}(r.a.Component),Ie=Object(v.a)((function(e){return Object(h.a)({root:{display:"flex",justifyContent:"center"},menuButton:{marginRight:e.spacing(2)},hide:{display:"none"},content:{flexGrow:1,maxWidth:1e3,padding:e.spacing(3),marginTop:e.spacing(6)},button:{marginLeft:16,marginTop:8,marginRight:16,marginBottom:8},paper:{width:"100%",marginTop:e.spacing(3),overflowX:"auto"},table:{minWidth:650}})}))(Ee);i.a.render(r.a.createElement(Ie,null),document.getElementById("root"))},96:function(e,t,n){e.exports=n(108)}},[[96,1,2]]]);
//# sourceMappingURL=main.a378b4ac.chunk.js.map