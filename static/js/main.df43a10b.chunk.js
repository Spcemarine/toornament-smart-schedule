(this["webpackJsonptoornament-smart-schedule"]=this["webpackJsonptoornament-smart-schedule"]||[]).push([[0],{102:function(e,t,n){e.exports=n(114)},114:function(e,t,n){"use strict";n.r(t);var a,r=n(0),s=n.n(r),i=n(9),o=n.n(i),c=n(13),u=n(14),l=n(16),d=n(17),h=n(176),p=n(170),m=n(171),g=n(156),f=n(52),v=n(4),y=n(82),k=n(62),E=n(27),b=n.n(E),I=function(){function e(){Object(c.a)(this,e),this.apiKey=void 0,this.token=void 0,this.apiKey=this.readApiKey(),this.token=this.readToken()}return Object(u.a)(e,[{key:"getToken",value:function(e,t,n){var a=this;if(null==this.apiKey)return!1;var r=new XMLHttpRequest;r.open("POST","https://api.toornament.com/oauth/v2/token"),r.setRequestHeader("X-Api-Key",this.apiKey),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.addEventListener("load",(function(e){var t=JSON.parse(r.responseText);a.updateToken(t.access_token,t.expires_in),n()}));var s="grant_type=client_credentials&client_id=".concat(e,"&client_secret=").concat(t,"&scope=organizer:result");r.send(s)}},{key:"readToken",value:function(){var e=sessionStorage.getItem("tss_t_at");if(null==e)return null;var t=sessionStorage.getItem("tss_t_ed");return null==t?null:{accessToken:e,expireDate:JSON.parse(t)}}},{key:"readApiKey",value:function(){return sessionStorage.getItem("tss_t_ak")}},{key:"updateApiKey",value:function(e){if(""==e)return this.apiKey=null,void sessionStorage.removeItem("tss_t_ak");this.apiKey=e,sessionStorage.setItem("tss_t_ak",e)}},{key:"hasApiKey",value:function(){return null!=this.apiKey&&""!=this.apiKey}},{key:"getApiKey",value:function(){return this.apiKey}},{key:"updateToken",value:function(e,t){var n=b()().add(t,"minutes").toDate();sessionStorage.setItem("tss_t_at",e),sessionStorage.setItem("tss_t_ed",JSON.stringify(n)),this.token={accessToken:e,expireDate:n}}},{key:"tokenIsValid",value:function(){return null!=this.token&&!(this.token.expireDate<new Date)}},{key:"rangedToornamentGETAPICall",value:function(e,t,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50;if(null==this.apiKey)return!1;if(!r&&!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");e.startsWith("/")||(e="/"+e);var c=0,u=o-1,l=o,d=0,h=[],p=function o(p,m,g){m>=200&&m<300?(h.push.apply(h,Object(k.a)(p)),g<=0||p.length>=i&&i>0?n(h):(d+=l,a.makePagedAPIGETCall(e,t,c+d,u+d,o,r,s))):console.error(p)};return this.makePagedAPIGETCall(e,t,c,u,p,r,s),!0}},{key:"makePagedAPIGETCall",value:function(e,t,n,a,r){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];if(null==this.apiKey)return!1;var o=new XMLHttpRequest,c="https://api.toornament.com/".concat(s?"viewer":"organizer","/v2").concat(e);if(o.open("GET",c),o.setRequestHeader("X-Api-Key",this.apiKey),!s){if(!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");o.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken))}o.setRequestHeader("Range","".concat(t,"=").concat(n,"-").concat(a)),i.forEach((function(e){return o.setRequestHeader(e.name,e.value)})),o.addEventListener("load",(function(e){if(o.status>=200&&o.status<300){var t=0,n=JSON.parse(o.responseText),a=Object(y.a)(/.*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*([0-9]+)\x2D([0-9]+)\/([0-9]+)/,{start:1,end:2,total:3}),s=o.getResponseHeader("Content-Range");if(null!=s){var i=s.match(a);if(null!=i&&i.length>=4){var c=Number(i.groups.end),u=Number(i.groups.total);t=Math.max(t,u-c-1)}}else t=n.length>=50?50:0;r(n,o.status,t)}else r(o.statusText,o.status,NaN)})),o.send()}},{key:"makeAPIGETCall",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(null==this.apiKey)return!1;var r=new XMLHttpRequest,s="https://api.toornament.com/".concat(n?"viewer":"organizer","/v2").concat(e);if(r.open("GET",s),r.setRequestHeader("X-Api-Key",this.apiKey),!n){if(!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");r.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken))}a.forEach((function(e){return r.setRequestHeader(e.name,e.value)})),r.addEventListener("load",(function(e){if(r.status>=200&&r.status<300){var n=JSON.parse(r.responseText);t(n,r.status)}else t(r.statusText,r.status)})),r.send()}},{key:"getOrganizerMatches",value:function(e,t,n){var a="/tournaments/".concat(e,"/matches?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"matches",n)}},{key:"getOrganizerRounds",value:function(e,t,n){var a="/tournaments/".concat(e,"/rounds?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"rounds",n,!1)}},{key:"getOrganizerStages",value:function(e,t){var n="/tournaments/".concat(e,"/stages");this.makeAPIGETCall(n,t,!1)}},{key:"getOrganizerTournament",value:function(e){var t="/tournaments/".concat(e);this.makeAPIGETCall(t,(function(e){console.log(e)}),!1)}},{key:"getOrganizerMatchGames",value:function(e,t,n){var a="/tournaments/".concat(e,"/matches/").concat(t,"/games");this.rangedToornamentGETAPICall(a,"games",n,!1)}},{key:"getBracketNodes",value:function(e,t,n){var a="/tournaments/".concat(e,"/stages/").concat(t,"/bracket-nodes");this.rangedToornamentGETAPICall(a,"nodes",n,!0)}},{key:"getOrganizerGroups",value:function(e,t,n){var a="/tournaments/".concat(e,"/groups?stage_ids=").concat(t);this.rangedToornamentGETAPICall(a,"groups",n,!1)}},{key:"scheduleMatch",value:function(e,t,n,a){if(null==this.apiKey)return!1;var r="https://api.toornament.com/organizer/v2/tournaments/".concat(e,"/matches/").concat(t),s={scheduled_datetime:b()(n).format("YYYY-MM-DDTHH:mm:ssZ")},i=new XMLHttpRequest;if(i.open("PATCH",r),i.setRequestHeader("X-Api-Key",this.apiKey),!this.tokenIsValid())throw new Error("Access Token invalid. Create new Token.");i.setRequestHeader("Authorization","Bearer ".concat(this.token.accessToken)),i.addEventListener("load",(function(){if(i.status>=200&&i.status<300){var e=JSON.parse(i.responseText);a(e,i.status)}else a(i.statusText,i.status)})),i.send(JSON.stringify(s))}}]),e}(),C=n(177),S=n(154),O=n(116),T=n(168),w=n(181),R=n(169),x=n(174),A=n(155),D=n(146),N=n(158),M=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleChangeApiKey=function(e){a.props.toornamentHelper.updateApiKey(e.target.value),a.setState({apiKey:e.target.value}),a.props.credentialsUpdated()},a.handleChangeClientId=function(e){a.setState({clientId:e.target.value})},a.handleChangeClientSecret=function(e){a.setState({clientSecret:e.target.value})},a.requestToken=function(){if(!a.props.toornamentHelper.tokenIsValid()){a.props.toornamentHelper.getToken(a.state.clientId,a.state.clientSecret,(function(){a.props.credentialsUpdated()}))}},a.state={apiKey:e.toornamentHelper.getApiKey()||"",clientId:"",clientSecret:""},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(D.a,{container:!0,direction:"column"},s.a.createElement(C.a,{label:"Api Key",className:e.textField,value:this.state.apiKey,onChange:this.handleChangeApiKey,error:null==this.props.toornamentHelper.getApiKey(),helperText:null==this.props.toornamentHelper.getApiKey()?"You must specify an api key":"",margin:"dense"}),s.a.createElement(C.a,{label:"Client Id",className:e.textField,value:this.state.clientId,onChange:this.handleChangeClientId,margin:"dense"}),s.a.createElement(C.a,{label:"Client Secret",className:e.textField,value:this.state.clientSecret,onChange:this.handleChangeClientSecret,margin:"dense"}),s.a.createElement("div",null,s.a.createElement(A.a,{variant:"contained",color:this.props.toornamentHelper.tokenIsValid()?"default":"primary",className:e.button,onClick:this.requestToken},"Request Token")),s.a.createElement(f.a,{hidden:this.props.toornamentHelper.tokenIsValid()},"You must request a token to proceed."))}}]),n}(s.a.Component),j=Object(v.a)((function(e){return Object(h.a)({textField:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},button:{marginTop:e.spacing(1),marginBottom:e.spacing(1)}})}))(M),_=n(161),P=n(162),F=n(163),H=n(164),L=n(165),G=n(151),K=n(179),B=n(173),z=n(159),W=n(15),q=n(76),V=n(180),U=n(160),Y=n(172),J=n(81),X=n.n(J),Z=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChangeStartDate=function(t){var n=e.props.phase;n.startDate=null==t?t:t.toDate(),e.props.phaseChanged(n)},e.handleChangePhaseRound=function(t){var n=e.props.phase;n.startingRoundId=t.target.value,e.props.phaseChanged(n)},e.handleChangePhaseGroup=function(t){var n=e.props.phase;n.groupId=t.target.value,e.props.phaseChanged(n)},e.handleDelete=function(){e.props.phaseChanged(null)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.props.classes;return s.a.createElement(D.a,{item:!0,container:!0,direction:"row",alignContent:"center"},s.a.createElement(V.a,{title:"Select start date"},s.a.createElement("div",null,s.a.createElement(Y.a,{disablePast:!0,className:t.textField,ampm:!1,value:this.props.phase.startDate,label:"Phase Start",onChange:this.handleChangeStartDate}))),s.a.createElement(G.a,{className:t.textField},s.a.createElement(K.a,null,"Group"),s.a.createElement(B.a,{value:this.props.phase.groupId,onChange:this.handleChangePhaseGroup,inputProps:{name:"startRound"},disabled:this.props.phase.isFirst},this.props.structure.getGroups().map((function(e,t){return s.a.createElement(z.a,{value:e.id,key:"group-".concat(t,"-mi")},e.name)})))),s.a.createElement(G.a,{className:t.textField},s.a.createElement(K.a,null,"Start Round"),s.a.createElement(B.a,{value:this.props.phase.startingRoundId,onChange:this.handleChangePhaseRound,inputProps:{name:"startRound"},disabled:this.props.phase.isFirst},this.props.structure.getRounds().filter((function(t){return t.groupId==e.props.phase.groupId})).map((function(e,t){return s.a.createElement(z.a,{value:e.id,key:"round-".concat(t,"-mi")},e.name)})))),!this.props.phase.isFirst&&s.a.createElement(U.a,{size:"small","aria-label":"Delete",className:t.delButton,onClick:this.handleDelete},s.a.createElement(X.a,null)))}}]),n}(s.a.Component),Q=Object(v.a)((function(e){return Object(h.a)({textField:{margin:e.spacing(1),maxWidth:220},delButton:{margin:e.spacing(1)}})}))(Z);!function(e){e.Monthly="Monthly",e.Weekly="Weekly",e.Daily="Daily",e.Direct="Direct"}(a||(a={}));var $=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).renderMatchLengthConfig=function(){var e=a.props.classes;return s.a.createElement(_.a,{className:e.table,size:"small"},s.a.createElement(P.a,null,s.a.createElement(F.a,null,s.a.createElement(H.a,{className:e.tableHeader,align:"right"},"Games per Match"),s.a.createElement(H.a,{className:e.tableHeader},"Time per Match (Minutes)"))),s.a.createElement(L.a,null,a.props.config.matchLengthSettings.map((function(t,n){return s.a.createElement(F.a,{key:"row-".concat(n)},s.a.createElement(H.a,{component:"th",scope:"row",align:"right"},t.numberOfGames),s.a.createElement(H.a,null,s.a.createElement(C.a,{label:"Match Length",className:e.textField,value:t.matchLengthMin,onChange:a.handleChangeMatchLength(n),margin:"dense",variant:"outlined",type:"number",error:!a.isValidMatchLength(t.matchLengthMin)})))}))))},a.handleChangeMatchLength=function(e){return function(t){var n=a.props.config;n.matchLengthSettings[e].matchLengthMin=Number(t.target.value),a.props.scheduleConfigChanged(n)}},a.handleChangeMatchMode=function(e){var t=a.props.config;t.schedulingMode=e.target.value,a.props.scheduleConfigChanged(t)},a.isValidMatchLength=function(e){return e>0&&Number.isInteger(e)},a.onPhaseChanged=function(e){return function(t){var n=a.props.config;null!=t?n.phases[e]=t:n.phases.splice(e,1),a.props.scheduleConfigChanged(n)}},a.addPhase=function(){var e=a.props.config,t=a.props.structure.getRounds().find((function(e){return a.props.config.phases.findIndex((function(t){return t.startingRoundId==e.id}))<0}));void 0!=t&&(e.phases.push({groupId:t.groupId,startingRoundId:t.id,startDate:e.phases[e.phases.length-1].startDate,isFirst:!1}),a.props.scheduleConfigChanged(e))},a}return Object(u.a)(n,[{key:"canAddNewPhase",value:function(){return this.props.config.phases.length<this.props.structure.getRounds().length}},{key:"render",value:function(){var e=this,t=this.props.classes,n=[a.Direct,a.Daily,a.Weekly,a.Monthly],r=this.props.config.phases.map((function(t,n){return s.a.createElement(Q,{phase:t,structure:e.props.structure,phaseChanged:e.onPhaseChanged(n),key:"phase-".concat(n)})}));return s.a.createElement(D.a,{container:!0,direction:"column"},s.a.createElement(f.a,{className:t.title,variant:"h6"},"Schedule Mode"),s.a.createElement(f.a,{paragraph:!0},"Decide how rounds should be scheduled. By specifying a mode other than ",a.Direct," you can schedule your matches on a daily, weekly or monthly basis. Each round is going to take place at a new date. In ",a.Direct," mode matches will occur at the earliest time after all previous matches have been played. Therefore it is well suited for brackets."),s.a.createElement(G.a,{className:t.textField},s.a.createElement(K.a,null,"Schedule Mode"),s.a.createElement(B.a,{value:this.props.config.schedulingMode,onChange:this.handleChangeMatchMode,inputProps:{name:"schedulingMode"}},n.map((function(e,t){return s.a.createElement(z.a,{value:e,key:"mode-".concat(t,"-mi")},e)})))),s.a.createElement(f.a,{className:t.title,variant:"h6",component:"div"},"Manage Phases"),s.a.createElement(f.a,null,"You can use Phases to start a part of your tournament at a different time. For example if you wanted to skip a day in your weekly round robin because its christmas eve or something, you would add a new phase starting at the first match day after the skipped day."),s.a.createElement(f.a,null,"This also enables you to use the ",a.Direct," mode to schedule a bracket over the course of two days by adding a phase for the second day."),s.a.createElement(f.a,null,"Please note that the integrety of your structure will not be verified. You are resposible for starting phases at the right time and date. If you do not need to use phases just use the first one as the starting date for your tournament."),s.a.createElement(W.a,{utils:q.a},r,s.a.createElement(A.a,{variant:"contained",color:"primary",onClick:this.addPhase,disabled:!this.canAddNewPhase()},"Add Phase")),s.a.createElement(f.a,{className:t.title,variant:"h6"},"Match Length"),this.renderMatchLengthConfig())}}]),n}(s.a.Component),ee=Object(v.a)((function(e){return Object(h.a)({textField:{marginTop:e.spacing(1),marginRight:e.spacing(2),marginBottom:e.spacing(1),maxWidth:300},button:{marginLeft:e.spacing(2),marginTop:e.spacing(1),marginRight:e.spacing(2),marginBottom:e.spacing(1)},table:{minWidth:450,maxWidth:600},tableHeader:{fontSize:"1em",fontWeight:"bolder",color:e.palette.text.primary},title:{marginTop:e.spacing(3),marginBottom:e.spacing(1),borderBottomColor:e.palette.secondary.main,borderBottomStyle:"solid",borderBottomWidth:4,flexShrink:1}})}))($),te=function(){function e(t,n,a,r){Object(c.a)(this,e),this.rounds=void 0,this.groups=void 0,this.matches=void 0,this.bracketType=void 0,this.roundDependencies=void 0,this.rounds=t,this.groups=n,this.matches=a,this.bracketType=r,this.roundDependencies=[],this.createDependencies()}return Object(u.a)(e,[{key:"createDependencies",value:function(){var e=this;this.matches.forEach((function(t,n){var a,r,s=e.roundDependencies.findIndex((function(e){return e.roundId===t.roundId}));s<0&&(s=e.roundDependencies.length,e.roundDependencies.push({roundId:t.roundId,precedingRoundIds:[],followingRoundIds:[]}));var i=e.roundDependencies[s],o=[];t.opponents.map((function(e){return e.sourceNodeId})).filter((function(e){return null!=e})).forEach((function(t){var n=e.matches.find((function(e){return e.id===t}));void 0!==n&&i.precedingRoundIds.findIndex((function(e){return e===n.roundId}))<0&&o.findIndex((function(e){return e===n.roundId}))<0&&o.push(n.roundId)}));var c=e.roundDependencies.filter((function(e){return e.precedingRoundIds.findIndex((function(e){return e===t.roundId}))>=0})).map((function(e){return e.roundId}));c=c.filter((function(e){return i.followingRoundIds.findIndex((function(t){return e===t}))<0})),(a=e.roundDependencies[s].precedingRoundIds).push.apply(a,o),(r=e.roundDependencies[s].followingRoundIds).push.apply(r,Object(k.a)(c)),o.forEach((function(n){var a=e.roundDependencies.findIndex((function(e){return e.roundId===n}));a>=0&&e.roundDependencies[a].followingRoundIds.findIndex((function(e){return e===t.roundId}))<0&&e.roundDependencies[a].followingRoundIds.push(t.roundId)})),e.roundDependencies[s]=i}))}},{key:"getRounds",value:function(){return this.rounds}},{key:"getMatches",value:function(){return this.matches}},{key:"getGroups",value:function(){return this.groups}},{key:"getFirstRounds",value:function(){var e=this,t=[];switch(this.bracketType){case ce.Bracket:this.roundDependencies.filter((function(e){return 0===e.precedingRoundIds.length})).forEach((function(n){var a=e.rounds.find((function(e){return e.id===n.roundId}));void 0!==a&&t.push(a)}));break;default:case ce.Rounds:this.groups.forEach((function(n){var a=e.rounds.find((function(e){return e.groupId===n.id}));void 0!==a&&t.push(a)}))}return t}},{key:"getFollowingRounds",value:function(e){var t=this.roundDependencies.find((function(t){return t.roundId===e}));return void 0===t?[]:this.rounds.filter((function(e){return t.followingRoundIds.findIndex((function(t){return t===e.id}))>=0}))}},{key:"getPrecedingRounds",value:function(e){var t=this,n=[];switch(this.bracketType){case ce.Bracket:var a=this.roundDependencies.find((function(t){return t.roundId===e}));if(void 0===a)break;n=this.rounds.filter((function(e){return a.precedingRoundIds.findIndex((function(t){return t===e.id}))>=0}));break;case ce.Rounds:default:this.groups.map((function(e){return t.rounds.filter((function(t){return t.groupId===e.id}))})).forEach((function(t){var a=t.findIndex((function(t){return t.id===e}));a>0&&n.push(t[a-1])}))}return n}},{key:"getLastRounds",value:function(){var e=this;return this.rounds.filter((function(t){return e.roundDependencies.findIndex((function(e){return e.roundId===t.id&&0===e.followingRoundIds.length}))>=0}))}},{key:"scheduleTournament",value:function(e){var t=this;this.getLastRounds().forEach((function(n){return t.scheduleRound(n.id,e)})),this.matches.forEach((function(n){return t.scheduleMatch(n.id,e)}))}},{key:"scheduleRound",value:function(e,t){var n=this,r=t.matchLengthSettings,s=t.phases,i=t.schedulingMode,o=this.rounds.findIndex((function(t){return t.id===e}));if(o<0)throw new Error("Round must be in TournamentStructure.");var c=this.rounds[o],u=s.find((function(e){return e.startingRoundId===c.id})),l=this.getPrecedingRounds(c.id);if(void 0!==u)this.rounds[o].scheduledAt=u.startDate,l.forEach((function(e){return n.scheduleRound(e.id,t)}));else if(0===l.length)this.rounds[o].scheduledAt=s[0].startDate;else{var d=l.map((function(e){return{date:n.scheduleRound(e.id,t),round:e}}));d.sort((function(e,t){return t.date.getTime()-e.date.getTime()}));var h=b()(d[0].date);switch(i){case a.Daily:this.rounds[o].scheduledAt=h.add(1,"days").toDate();break;case a.Weekly:this.rounds[o].scheduledAt=h.add(1,"weeks").toDate();break;case a.Monthly:this.rounds[o].scheduledAt=h.add(1,"months").toDate();break;case a.Direct:default:var p=r.find((function(e){return e.numberOfGames===d[0].round.roundLength}))||{matchLengthMin:30,numberOfGames:1};this.rounds[o].scheduledAt=h.add(p.matchLengthMin,"minutes").toDate()}}return this.rounds[o].scheduledAt}},{key:"scheduleMatch",value:function(e,t){var n=t.matchLengthSettings,r=this.matches.findIndex((function(t){return t.id===e}));if(r<0)throw new Error("Round must be in TournamentStructure.");var s=this.matches[r],i=this.rounds.findIndex((function(e){return e.id===s.roundId}));if(i<0)throw new Error("Round must be in TournamentStructure.");var o=this.rounds[i];if(this.matches[r].scheduledAt=o.scheduledAt,t.schedulingMode!==a.Direct){var c=this.matches.filter((function(e){return e.roundId===s.roundId&&e.id!==s.id&&null!==e.scheduledAt&&e.participants.some((function(e){return s.participants.some((function(t){return e.id===t.id}))}))}));if(c.length>0){c.sort((function(e,t){return t.scheduledAt.getTime()-e.scheduledAt.getTime()}));var u=c[c.length-1],l=b()(u.scheduledAt),d=n.find((function(e){return e.numberOfGames===o.roundLength}))||{matchLengthMin:30,numberOfGames:1};this.matches[r].scheduledAt=l.add(d.matchLengthMin,"minutes").toDate()}}return this.matches[r].scheduledAt}}]),e}(),ne=n(175),ae=n(167),re=n(157),se=n(41),ie=n.n(se),oe=n(166);var ce,ue=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).fetchOnUpdate=!1,a.state={roundsFinished:!1,matchesFinished:!1,groupsFinished:!1,rounds:[],matches:[],groups:[],matchIndex:0,bracketNodeIndex:0},a}return Object(u.a)(n,[{key:"fetchStageData",value:function(){var e=this,t=this.props,n=t.tournamentId,a=t.stageId,r=t.toornamentHelper,s=t.callback;r.getOrganizerGroups(n,a,(function(t){var n=t.map((function(e){return{id:e.id,name:e.name,number:e.number}}));e.setState({groups:n,groupsFinished:!0}),e.state.roundsFinished&&e.state.matchesFinished&&s(e.state.rounds,e.state.matches,e.state.groups)})),r.getOrganizerRounds(n,a,(function(t){var n=t.map((function(e){return{id:e.id,groupId:e.group_id,name:e.name,number:e.number,size:e.settings.size,scheduledAt:null,roundLength:1}}));e.setState({rounds:n,roundsFinished:!0}),e.state.matchesFinished&&e.state.groupsFinished&&s(e.state.rounds,e.state.matches,e.state.groups)})),r.getOrganizerMatches(n,a,(function(t){var i=t.map((function(e){var t=[];return e.opponents.forEach((function(e){e.participant&&t.push({id:e.participant.id,name:e.participant.name})})),{id:e.id,groupId:e.group_id,roundId:e.round_id,numberOfGames:0,scheduledAt:null,opponents:[],participants:t}}));e.setState({matches:i});var o=function(){r.getBracketNodes(n,a,(function(t){t.forEach((function(t,n){var a=n,r=e.state.matches,s=r[a];if(null==s||s.id!==t.id){if((a=r.findIndex((function(e){return e.id===t.id})))<0)return;s=r[a]}s.opponents=t.opponents.map((function(e){return{number:e.number,sourceType:e.source_type,sourceNodeId:e.source_node_id}})),r[a]=s,e.setState({matches:r,bracketNodeIndex:n+1})})),e.state.roundsFinished&&e.state.groupsFinished?s(e.state.rounds,e.state.matches,e.state.groups):e.setState({matchesFinished:!0})}))};!function t(){if(e.state.matchIndex>=e.state.matches.length)o();else{var a=e.state.matches[e.state.matchIndex].id;r.getOrganizerMatchGames(n,a,(function(n){var a=e.state.matches;a[e.state.matchIndex].numberOfGames=n.length,e.setState({matches:a,matchIndex:e.state.matchIndex+1}),t()}))}}()}))}},{key:"componentWillReceiveProps",value:function(e){!this.props.open&&e.open&&(this.fetchOnUpdate=!0)}},{key:"componentDidUpdate",value:function(){this.fetchOnUpdate&&(this.fetchOnUpdate=!1,this.setState({roundsFinished:!1,matchesFinished:!1,groupsFinished:!1,rounds:[],matches:[],groups:[],matchIndex:0,bracketNodeIndex:0}),this.fetchStageData())}},{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(ne.a,{open:this.props.open},s.a.createElement(ae.a,null,"Fetching Tournament Properties..."),s.a.createElement(re.a,null,s.a.createElement(D.a,{container:!0,direction:"row"},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.groupsFinished?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,"Fetching Groups")),s.a.createElement(D.a,{container:!0,direction:"row"},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.roundsFinished?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,"Fetching Rounds")),s.a.createElement(D.a,{container:!0,direction:"row"},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},0!==this.state.matches.length?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,"Fetching Matches")),s.a.createElement(D.a,{container:!0,direction:"row",hidden:0===this.state.matches.length},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.matchIndex>=this.state.matches.length?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,this.state.matchIndex,"/",this.state.matches.length," Fetching Match Length")),s.a.createElement(D.a,{container:!0,direction:"row",hidden:this.state.matchIndex<this.state.matches.length},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.state.bracketNodeIndex>=this.state.matches.length?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,this.state.bracketNodeIndex,"/",this.state.matches.length," Fetching Bracket Nodes"))))}}]),n}(s.a.Component),le=Object(v.a)((function(e){return Object(h.a)({checkIcon:{color:oe.a[300]},iconContainer:{width:20,marginRight:e.spacing(1)}})}))(ue),de=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).getGroupName=function(t){var n=e.props.structure.getGroups().find((function(e){return e.id==t.groupId}));return void 0!=n?n.name:"Unknown Group"},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=(this.props.classes,this.props.structure.getRounds().sort((function(e,t){return null==e.scheduledAt?-1:null==t.scheduledAt?1:e.scheduledAt.getTime()-t.scheduledAt.getTime()})).map((function(t){return s.a.createElement(F.a,null,s.a.createElement(H.a,null,e.getGroupName(t)),s.a.createElement(H.a,null,t.name),s.a.createElement(H.a,null,null!=t.scheduledAt?b()(t.scheduledAt).format("llll"):"Error while scheduling, please contact dev."))})));return s.a.createElement(_.a,null,s.a.createElement(L.a,null,t))}}]),n}(s.a.Component),he=Object(v.a)((function(e){return Object(h.a)({})}))(de),pe=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(ne.a,{open:this.props.open},s.a.createElement(ae.a,null,"Applying Changes"),s.a.createElement(re.a,null,s.a.createElement(D.a,{container:!0,direction:"row"},s.a.createElement(D.a,{item:!0,container:!0,alignContent:"center",className:e.iconContainer},this.props.progress!=this.props.total?s.a.createElement(ie.a,{className:e.checkIcon}):s.a.createElement(N.a,{size:20})),s.a.createElement(f.a,null,this.props.progress,"/",this.props.total," Applying Matches"))))}}]),n}(s.a.Component),me=Object(v.a)((function(e){return Object(h.a)({checkIcon:{color:oe.a[300]},iconContainer:{width:20,marginRight:e.spacing(1)}})}))(pe);!function(e){e[e.Bracket=0]="Bracket",e[e.Rounds=1]="Rounds"}(ce||(ce={}));var ge=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(c.a)(this,n),(r=t.call(this,e)).steps=["Credentials","Tournament","Stage","Configuration","Review"],r.handleNext=function(){switch(r.state.activeStep){case 1:r.setState({fetching:!0}),r.props.toornamentHelper.getOrganizerStages(r.state.tournamentId,(function(e){console.log(e);var t=e.map((function(e){return{id:e.id,name:e.name,number:e.number,size:e.settings.size,type:e.type}}));r.setState({stages:t,activeStep:r.state.activeStep+1,fetching:!1})}));break;case 2:var e=r.state.stages.find((function(e){return e.id===r.state.stageId})),t=r.state.scheduleConfig;switch(e.type){case"single_elimination":case"double_elimination":case"gauntlet":case"ffa_single_elimination":t.schedulingMode=a.Direct,t.bracketType=ce.Bracket;break;case"bracket_groups":case"pools":case"league":case"swiss":case"simple":case"ffa_bracket_groups":default:t.schedulingMode=a.Weekly,t.bracketType=ce.Rounds}r.setState({scheduleConfig:t,fetching:!0,fetchDialogOpen:!0});break;case 3:r.setState({fetching:!0}),r.state.structure.scheduleTournament(r.state.scheduleConfig),r.setState({fetching:!1,activeStep:r.state.activeStep+1});break;case 4:r.setState({fetching:!0}),r.applySchedule((function(){return r.setState({fetching:!1,activeStep:r.state.activeStep+1,applyOpen:!1})}));break;default:r.setState({activeStep:r.state.activeStep+1})}},r.applySchedule=function(e){var t=r.state.structure.getMatches(),n=r.state.structure.getRounds();r.setState({applyOpen:!0,applyTotal:t.length,applyProgress:0});var a=0;!function s(){if(a>=t.length)e();else{var i=t[a],o=n.find((function(e){return e.id===i.roundId}))||n[0],c=function(){a++,r.setState({applyProgress:a}),s()};null!==o.scheduledAt||null!==i.scheduledAt?r.props.toornamentHelper.scheduleMatch(r.state.tournamentId,i.id,i.scheduledAt||o.scheduledAt,(function(e,t){(t<200||t>300)&&console.log(e),c()})):c()}}()},r.fetchCallback=function(e,t,n){var a=r.state.scheduleConfig,s=[];t.forEach((function(t){s.findIndex((function(e){return e===t.numberOfGames}))<0&&s.push(t.numberOfGames);var n=e.findIndex((function(e){return e.id===t.roundId}));n>=0&&e[n].roundLength<t.numberOfGames&&(e[n].roundLength=t.numberOfGames)})),a.matchLengthSettings=s.map((function(e){return{numberOfGames:e,matchLengthMin:30}}));var i=new te(e,n,t,a.bracketType),o=i.getFirstRounds();a.phases=o.map((function(e){return{startingRoundId:e.id,groupId:e.groupId,startDate:new Date,isFirst:!0}})),r.setState({activeStep:r.state.activeStep+1,scheduleConfig:a,structure:i,fetching:!1,fetchDialogOpen:!1})},r.handleBack=function(){0!==r.state.activeStep&&r.setState({activeStep:r.state.activeStep-1})},r.handleReset=function(){r.setState({activeStep:0})},r.handleChangeTournamentId=function(e){var t=e.target.value;sessionStorage.setItem("tss_i_ti",t),r.setState({tournamentId:t})},r.handleChangeStageId=function(e){var t=e.target.value;sessionStorage.setItem("tss_i_si",t),r.setState({stageId:t})},r.canProceed=function(){switch(r.state.activeStep){case 0:return r.state.credentialsReady;case 1:return""!==r.state.tournamentId;case 2:return""!==r.state.stageId;default:return!0}},r.getStepContent=function(e){var t=r.props.classes;switch(e){case 0:return s.a.createElement(j,{toornamentHelper:r.props.toornamentHelper,credentialsUpdated:r.credentialsUpdated});case 1:return s.a.createElement("div",null,s.a.createElement(C.a,{label:"Tournament Id",className:t.textField,value:r.state.tournamentId,onChange:r.handleChangeTournamentId,margin:"dense",variant:"outlined"}),s.a.createElement(f.a,null,"Enter the tournament id."),s.a.createElement(f.a,{variant:"caption",display:"block"},"You will find it in the Link to your tournament. In this example the higlighted part is the tournament id:"),s.a.createElement(f.a,{variant:"caption",display:"block"},"https://www.toornament.com/en_US/tournaments/",s.a.createElement(f.a,{variant:"caption",color:"secondary",display:"inline"},"2859636902129573888"),"/information"));case 2:return s.a.createElement("div",null,s.a.createElement(S.a,null,r.state.stages.map((function(e,t){return s.a.createElement(O.a,{button:!0,selected:r.state.stageId===e.id,onClick:function(){return r.setState({stageId:e.id})},key:"stage-".concat(t)},s.a.createElement(T.a,{primary:"".concat(e.number,". ").concat(e.name),secondary:"".concat(e.size," Teams")}))}))),s.a.createElement(le,{open:r.state.fetchDialogOpen,tournamentId:r.state.tournamentId,stageId:r.state.stageId,callback:r.fetchCallback,toornamentHelper:r.props.toornamentHelper}));case 3:return s.a.createElement(ee,{config:r.state.scheduleConfig,scheduleConfigChanged:r.scheduleConfigChanged,structure:r.state.structure});case 4:return s.a.createElement(he,{structure:r.state.structure});default:return s.a.createElement("div",null)}},r.scheduleConfigChanged=function(e){r.setState({scheduleConfig:e})},r.credentialsUpdated=function(){var e=r.props.toornamentHelper.hasApiKey()&&r.props.toornamentHelper.tokenIsValid();r.setState({credentialsReady:e})};var i=e.toornamentHelper.hasApiKey()&&e.toornamentHelper.tokenIsValid();return r.state={activeStep:i?1:0,credentialsReady:i,tournamentId:sessionStorage.getItem("tss_i_ti")||"",stages:[],stageId:sessionStorage.getItem("tss_i_si")||"",scheduleConfig:{schedulingMode:a.Direct,matchLengthSettings:[{numberOfGames:3,matchLengthMin:30},{numberOfGames:5,matchLengthMin:45}],phases:[],bracketType:ce.Bracket},structure:new te([],[],[],ce.Bracket),fetching:!1,fetchDialogOpen:!1,applyOpen:!1,applyProgress:0,applyTotal:0},r}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement("div",{className:e.root},s.a.createElement(w.a,{activeStep:this.state.activeStep},this.steps.map((function(e,t){var n={};return s.a.createElement(R.a,Object.assign({key:e},{}),s.a.createElement(x.a,n,e))}))),s.a.createElement("div",null,this.state.activeStep===this.steps.length?s.a.createElement("div",null,s.a.createElement(f.a,{className:e.instructions},"Your stage has beeen scheduled. If you want to schedule another stage press the button below."),s.a.createElement(A.a,{onClick:this.handleReset,className:e.button},"Back to start.")):s.a.createElement("div",null,s.a.createElement("div",{className:e.instructions},this.getStepContent(this.state.activeStep)),s.a.createElement(D.a,{container:!0,alignContent:"center",direction:"row"},s.a.createElement(A.a,{disabled:0===this.state.activeStep,onClick:this.handleBack,className:e.button},"Back"),s.a.createElement(A.a,{variant:"contained",color:"primary",onClick:this.handleNext,className:e.button,disabled:!this.canProceed()},this.state.activeStep===this.steps.length-1?"Finish":"Next"),s.a.createElement("div",{hidden:!this.state.fetching},s.a.createElement(N.a,{size:30,thickness:5}))))),s.a.createElement(me,{open:this.state.applyOpen,progress:this.state.applyProgress,total:this.state.applyTotal}),s.a.createElement("img",{src:"./PoweredbyToor_Black.png",className:e.toorImg,alt:"Powered By Toornament"}),s.a.createElement(f.a,{variant:"body2",color:"textSecondary"},Object({NODE_ENV:"production",PUBLIC_URL:"/toornament-smart-schedule",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_VERSION||"Version not found"))}}]),n}(s.a.Component),fe=Object(v.a)((function(e){return Object(h.a)({root:{width:"90%"},button:{marginRight:e.spacing(1)},instructions:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},toorImg:{maxWidth:250}})}))(ge),ve=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).fetchEverything=function(){a.state.toornamentHelper.tokenIsValid()},a.state={toornamentHelper:new I},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement("div",{className:e.root},s.a.createElement(p.a,null),s.a.createElement(m.a,{position:"fixed",className:e.appBar},s.a.createElement(g.a,{variant:"dense"},s.a.createElement(f.a,{variant:"h6",noWrap:!0},"Toornament Smart Schedule"))),s.a.createElement("main",{className:e.content},s.a.createElement(fe,{toornamentHelper:this.state.toornamentHelper})))}}]),n}(s.a.Component),ye=Object(v.a)((function(e){return Object(h.a)({root:{display:"flex",justifyContent:"center"},menuButton:{marginRight:e.spacing(2)},hide:{display:"none"},content:{flexGrow:1,maxWidth:1e3,padding:e.spacing(3),marginTop:e.spacing(6)},button:{marginLeft:16,marginTop:8,marginRight:16,marginBottom:8},paper:{width:"100%",marginTop:e.spacing(3),overflowX:"auto"},table:{minWidth:650}})}))(ve);o.a.render(s.a.createElement(ye,null),document.getElementById("root"))}},[[102,1,2]]]);
//# sourceMappingURL=main.df43a10b.chunk.js.map